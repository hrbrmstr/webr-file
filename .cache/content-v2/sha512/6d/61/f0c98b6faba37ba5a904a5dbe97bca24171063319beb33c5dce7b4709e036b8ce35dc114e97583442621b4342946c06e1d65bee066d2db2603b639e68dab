/**
 * Bundled by jsDelivr using Rollup v2.74.1 and Terser v5.15.1.
 * Original file: /npm/arquero@5.1.0/src/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Data as t,Vector as e,makeBuilder as n,Type as r,DataType as o,Utf8 as s,Uint64 as a,Uint32 as i,Uint16 as u,Uint8 as c,TimeSecond as l,TimeNanosecond as f,TimeMillisecond as p,TimeMicrosecond as m,Null as d,IntervalYearMonth as h,IntervalDayTime as g,Int64 as y,Int32 as _,Int16 as v,Int8 as b,Float64 as w,Float32 as x,Float16 as M,Dictionary as j,DateMillisecond as E,DateDay as $,Bool as O,Binary as k,Field as S,FixedSizeList as N,List as A,Struct as T,Table as I,tableFromIPC as C,tableToIPC as U}from"/npm/apache-arrow@9.0.0/+esm";import{parse as F}from"/npm/acorn@8.8.2/+esm";var R=Array.isArray;function D(t){return null!=t?R(t)?t:[t]:[]}function z(t){return t<0?`count() + ${t}`:t}class q{constructor(t){t&&(this._params=t)}params(t){return arguments.length?(t&&(this._params={...this._params,...t}),this):this._params}reify(t){return this.__reify(this,t)}count(t){return this.__count(this,t)}derive(t,e){return this.__derive(this,t,e)}filter(t){return this.__filter(this,t)}slice(t,e){return this.filter(function(t=0,e=1/0){return`${z(t)} < row_number() && row_number() <= ${z(e)}`}(t,e)).reify()}groupby(...t){return this.__groupby(this,t.flat())}orderby(...t){return this.__orderby(this,t.flat())}relocate(t,e){return this.__relocate(this,D(t),e)}rename(...t){return this.__rename(this,t.flat())}rollup(t){return this.__rollup(this,t)}sample(t,e){return this.__sample(this,t,e)}select(...t){return this.__select(this,t.flat())}ungroup(){return this.__ungroup(this)}unorder(){return this.__unorder(this)}dedupe(...t){return this.__dedupe(this,t.flat())}impute(t,e){return this.__impute(this,t,e)}fold(t,e){return this.__fold(this,t,e)}pivot(t,e,n){return this.__pivot(this,t,e,n)}spread(t,e){return this.__spread(this,t,e)}unroll(t,e){return this.__unroll(this,t,e)}lookup(t,e,...n){return this.__lookup(this,t,e,n.flat())}join(t,e,n,r){return this.__join(this,t,e,n,r)}join_left(t,e,n,r){const o={...r,left:!0,right:!1};return this.__join(this,t,e,n,o)}join_right(t,e,n,r){const o={...r,left:!1,right:!0};return this.__join(this,t,e,n,o)}join_full(t,e,n,r){const o={...r,left:!0,right:!0};return this.__join(this,t,e,n,o)}cross(t,e,n){return this.__cross(this,t,e,n)}semijoin(t,e){return this.__semijoin(this,t,e)}antijoin(t,e){return this.__antijoin(this,t,e)}concat(...t){return this.__concat(this,t.flat())}union(...t){return this.__union(this,t.flat())}intersect(...t){return this.__intersect(this,t.flat())}except(...t){return this.__except(this,t.flat())}}function L(t){throw Error(t)}function P(t){return"number"==typeof t}function J(t){return"function"==typeof t}function V(t,e){const n=Array(t);if(J(e))for(let r=0;r<t;++r)n[r]=e(r);else n.fill(e);return n}class B extends q{constructor(t,e,n,r,o,s,a){super(a),this._names=Object.freeze(t),this._data=n,this._total=e,this._nrows=r?r.count():e,this._mask=e!==this._nrows&&r||null,this._group=o||null,this._order=s||null}create(t){L("Not implemented")}get[Symbol.toStringTag](){if(!this._names)return"Object";const t=this.numRows()+" row"+(1!==this.numRows()?"s":"");return`Table: ${this.numCols()+" col"+(1!==this.numCols()?"s":"")} x ${t}`+(this.isFiltered()?` (${this.totalRows()} backing)`:"")+(this.isGrouped()?`, ${this._group.size} groups`:"")+(this.isOrdered()?", ordered":"")}isFiltered(){return!!this._mask}isGrouped(){return!!this._group}isOrdered(){return!!this._order}data(){return this._data}mask(){return this._mask}groups(){return this._group}comparator(){return this._order}totalRows(){return this._total}numRows(){return this._nrows}get size(){return this._nrows}numCols(){return this._names.length}columnNames(t){return t?this._names.filter(t):this._names.slice()}columnName(t){return this._names[t]}columnIndex(t){return this._names.indexOf(t)}columnArray(t,e){return this.array(t,e)}array(t,e){L("Not implemented")}*values(t){const e=this.getter(t),n=this.numRows();for(let t=0;t<n;++t)yield e(t)}get(t,e=0){L("Not implemented")}getter(t){L("Not implemented")}objects(t){L("Not implemented")}object(t){L("Not implemented")}[Symbol.iterator](){L("Not implemented")}print(t={}){P(t)?t={limit:t}:null==t.limit&&(t.limit=10);const e=this.objects({...t,grouped:!1}),n=`${this[Symbol.toStringTag]}. Showing ${e.length} rows.`;return console.log(n),console.table(e),this}indices(t=!0){if(this._index)return this._index;const e=this.numRows(),n=new Uint32Array(e),r=this.isOrdered(),o=this.mask();let s=-1;if(o)for(let t=o.next(0);t>=0;t=o.next(t+1))n[++s]=t;else for(let t=0;t<e;++t)n[++s]=t;if(t&&r){const t=this._order,e=this._data;n.sort(((n,r)=>t(n,r,e)))}return!t&&r||(this._index=n),n}partitions(t=!0){if(this._partitions)return this._partitions;if(!this.isGrouped())return[this.indices(t)];const{keys:e,size:n}=this._group,r=V(n,(()=>[])),o=this._index,s=this.mask(),a=this.numRows();if(o&&this.isOrdered())for(let t,n=0;n<a;++n)t=o[n],r[e[t]].push(t);else if(s)for(let t=s.next(0);t>=0;t=s.next(t+1))r[e[t]].push(t);else for(let t=0;t<a;++t)r[e[t]].push(t);if(t&&!o&&this.isOrdered()){const t=this._order,e=this._data;for(let o=0;o<n;++o)r[o].sort(((n,r)=>t(n,r,e)))}return!t&&this.isOrdered()||(this._partitions=r),r}scan(t,e,n=1/0,r=0){const o=this._mask,s=this._nrows,a=this._data;let i=r||0;if(i>s)return;const u=Math.min(s,i+n),c=()=>i=this._total;if(e&&this.isOrdered()||o&&this._index){const e=this.indices(),n=this._data;for(;i<u;++i)t(e[i],n,c)}else if(o){let e=u-i+1;for(i=o.nth(i);--e&&i>-1;i=o.next(i+1))t(i,a,c)}else for(;i<u;++i)t(i,a,c)}slice(t=0,e=1/0){if(this.isGrouped())return super.slice(t,e);const n=[],r=this.numRows();return t=Math.max(0,t+(t<0?r:0)),e=Math.min(r,Math.max(0,e+(e<0?r:0))),this.scan((t=>n.push(t)),!0,e-t,t),this.reify(n)}reduce(t){return this.__reduce(this,t)}}class G{constructor(t){this.data=t}get length(){return this.data.length}get(t){return this.data[t]}[Symbol.iterator](){return this.data[Symbol.iterator]()}}let H=function(t){return t&&J(t.get)?t:new G(t)};function W(t){return t instanceof Date}function K(t){return t===Object(t)}function Y(t){return t instanceof RegExp}function Q(t){return"string"==typeof t}function Z(t,e){const n=e=>L(`Illegal argument type: ${e||typeof t}`);return t instanceof Map?X(t.entries(),e):W(t)?n("Date"):Y(t)?n("RegExp"):Q(t)?n():R(t)?function(t,e){const n=t.length,r={},o=t=>r[t]=Array(n);if(n){const r=(e=e||Object.keys(t[0])).map(o),s=r.length;for(let o=0;o<n;++o){const n=t[o];for(let t=0;t<s;++t)r[t][o]=n[e[t]]}}else e&&e.forEach(o);return r}(t,e):J(t[Symbol.iterator])?function(t,e){const n={},r=t=>n[t]=[];let o,s;for(const n of t){o||(o=(e=e||Object.keys(n)).map(r),s=o.length);for(let t=0;t<s;++t)o[t].push(n[e[t]])}!o&&e&&e.forEach(r);return n}(t,e):K(t)?X(Object.entries(t),e):n()}function X(t,e=["key","value"]){const n=[],r=[];for(const[e,o]of t)n.push(e),r.push(o);const o={};return e[0]&&(o[e[0]]=n),e[1]&&(o[e[1]]=r),o}const{hasOwnProperty:tt}=Object.prototype;function et(t,e){return tt.call(t,e)}function nt(t){return t?new rt({...t.data()},t.columnNames()):new rt}class rt{constructor(t,e){this.data=t||{},this.names=e||[]}add(t,e){return this.has(t)||this.names.push(t+""),this.data[t]=e}has(t){return et(this.data,t)}new(){return this.filter=null,this.groups=this.groups||null,this.order=null,this}groupby(t){return this.groups=t,this}}var ot=void 0;const st=Object.getPrototypeOf(Int8Array);function at(t){return t instanceof st}function it(t){return R(t)||at(t)}function ut(t){return null!=t&&t==t}const ct=t=>it(t)||Q(t);var lt={compact:t=>it(t)?t.filter((t=>ut(t))):t,concat:(...t)=>[].concat(...t),includes:(t,e,n)=>!!ct(t)&&t.includes(e,n),indexof:(t,e)=>ct(t)?t.indexOf(e):-1,join:(t,e)=>it(t)?t.join(e):ot,lastindexof:(t,e)=>ct(t)?t.lastIndexOf(e):-1,length:t=>ct(t)?t.length:0,pluck:(t,e)=>it(t)?t.map((t=>ut(t)?t[e]:ot)):ot,reverse:t=>it(t)?t.slice().reverse():Q(t)?t.split("").reverse().join(""):ot,slice:(t,e,n)=>ct(t)?t.slice(e,n):ot};function ft(t,e,n="0"){const r=t+"",o=r.length;return o<e?Array(e-o+1).join(n)+r:r}const pt=t=>(t<10?"0":"")+t;function mt(t,e,n,r,o,s,a,i,u){const c=i?"Z":"";return(t=>t<0?"-"+ft(-t,6):t>9999?"+"+ft(t,6):ft(t,4))(t)+"-"+pt(e+1)+"-"+pt(n)+(!u||a?"T"+pt(r)+":"+pt(o)+":"+pt(s)+"."+ft(a,3)+c:s?"T"+pt(r)+":"+pt(o)+":"+pt(s)+c:o||r||!i?"T"+pt(r)+":"+pt(o)+c:"")}function dt(t,e){return isNaN(t)?"Invalid Date":mt(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds(),!1,e)}function ht(t,e){return isNaN(t)?"Invalid Date":mt(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds(),!0,e)}const gt=/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/;function yt(t){return t.match(gt)}const _t=new Date,vt=new Date,bt=t=>(_t.setTime("string"==typeof t?function(t,e=Date.parse){return yt(t)?e(t):t}(t):t),_t);var wt={format_date:(t,e)=>dt(bt(t),!e),format_utcdate:(t,e)=>ht(bt(t),!e),timestamp:t=>+bt(t),year:t=>bt(t).getFullYear(),quarter:t=>Math.floor(bt(t).getMonth()/3),month:t=>bt(t).getMonth(),date:t=>bt(t).getDate(),dayofweek:t=>bt(t).getDay(),hours:t=>bt(t).getHours(),minutes:t=>bt(t).getMinutes(),seconds:t=>bt(t).getSeconds(),milliseconds:t=>bt(t).getMilliseconds(),utcyear:t=>bt(t).getUTCFullYear(),utcquarter:t=>Math.floor(bt(t).getUTCMonth()/3),utcmonth:t=>bt(t).getUTCMonth(),utcdate:t=>bt(t).getUTCDate(),utcdayofweek:t=>bt(t).getUTCDay(),utchours:t=>bt(t).getUTCHours(),utcminutes:t=>bt(t).getUTCMinutes(),utcseconds:t=>bt(t).getUTCSeconds(),utcmilliseconds:t=>bt(t).getUTCMilliseconds(),datetime:function(t,e,n,r,o,s,a){return arguments.length?new Date(t,e||0,null==n?1:n,r||0,o||0,s||0,a||0):new Date(Date.now())},dayofyear:function(t){vt.setTime(+t),vt.setHours(0,0,0,0),_t.setTime(+vt),_t.setMonth(0),_t.setDate(1);const e=6e4*(vt.getTimezoneOffset()-_t.getTimezoneOffset());return Math.floor(1+(vt-_t-e)/864e5)},week:function(t,e){const n=e||0;vt.setTime(+t),vt.setDate(vt.getDate()-(vt.getDay()+7-n)%7),vt.setHours(0,0,0,0),_t.setTime(+t),_t.setMonth(0),_t.setDate(1),_t.setDate(1-(_t.getDay()+7-n)%7),_t.setHours(0,0,0,0);const r=6e4*(vt.getTimezoneOffset()-_t.getTimezoneOffset());return Math.floor((vt-_t+1-r)/6048e5)},utcdatetime:function(t,e,n,r,o,s,a){return arguments.length?new Date(Date.UTC(t,e||0,null==n?1:n,r||0,o||0,s||0,a||0)):new Date(Date.now())},utcdayofyear:function(t){vt.setTime(+t),vt.setUTCHours(0,0,0,0);const e=Date.UTC(vt.getUTCFullYear(),0,1);return Math.floor(1+(vt-e)/864e5)},utcweek:function(t,e){const n=e||0;return vt.setTime(+t),vt.setUTCDate(vt.getUTCDate()-(vt.getUTCDay()+7-n)%7),vt.setUTCHours(0,0,0,0),_t.setTime(+t),_t.setUTCMonth(0),_t.setUTCDate(1),_t.setUTCDate(1-(_t.getUTCDay()+7-n)%7),_t.setUTCHours(0,0,0,0),Math.floor((vt-_t+1)/6048e5)},now:Date.now};function xt(t,e){return null!=t&&null!=e&&t==t&&e==e&&(t===e||(W(t)||W(e)?+t==+e:Y(t)&&Y(e)?t+""==e+"":!(!K(t)||!K(e))&&function(t,e){if(Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;if(t.length||e.length)return Mt(t,e);const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;if(n.sort(),r.sort(),!Mt(n,r,((t,e)=>t===e)))return!1;const o=n.length;for(let r=0;r<o;++r){const o=n[r];if(!xt(t[o],e[o]))return!1}return!0}(t,e)))}function Mt(t,e,n=xt){const r=t.length;if(r!==e.length)return!1;for(let o=0;o<r;++o)if(!n(t[o],e[o]))return!1;return!0}var jt={parse_json:t=>JSON.parse(t),to_json:t=>JSON.stringify(t)};let Et=Math.random;function $t(){return Et()}function Ot(t){Et=ut(t)&&isFinite(t=+t)?function(t){const e=1664525,n=1013904223,r=1/4294967296;return t=0|(0<=t&&t<1?t/r:Math.abs(t)),()=>r*((t=e*t+n|0)>>>0)}(t):Math.random}function kt(t){return t instanceof Map}function St(t){return kt(t)||function(t){return t instanceof Set}(t)}function Nt(t){return Array.from(t)}var At={has:(t,e)=>St(t)?t.has(e):null!=t&&et(t,e),keys:t=>kt(t)?Nt(t.keys()):null!=t?Object.keys(t):[],values:t=>St(t)?Nt(t.values()):null!=t?Object.values(t):[],entries:t=>St(t)?Nt(t.entries()):null!=t?Object.entries(t):[],object:t=>t?Object.fromEntries(t):ot};function Tt(t,e,n){let r=arguments.length;t=+t,e=+e,n=r<2?(e=t,t=0,1):r<3?1:+n,r=0|Math.max(0,Math.ceil((e-t)/n));const o=new Array(r);for(let e=0;e<r;++e)o[e]=t+e*n;return o}var It={bin:function(t,e,n,r,o){return null==t?null:t<e?-1/0:t>n?1/0:(t=Math.max(e,Math.min(t,n)),e+r*Math.floor(1e-14+(t-e)/r+(o||0)))},equal:xt,recode:function(t,e,n){if(e instanceof Map){if(e.has(t))return e.get(t)}else if(et(e,t))return e[t];return void 0!==n?n:t},sequence:Tt,...lt,...wt,...jt,...{random:$t,is_nan:Number.isNaN,is_finite:Number.isFinite,abs:Math.abs,cbrt:Math.cbrt,ceil:Math.ceil,clz32:Math.clz32,exp:Math.exp,expm1:Math.expm1,floor:Math.floor,fround:Math.fround,greatest:Math.max,least:Math.min,log:Math.log,log10:Math.log10,log1p:Math.log1p,log2:Math.log2,pow:Math.pow,round:Math.round,sign:Math.sign,sqrt:Math.sqrt,trunc:Math.trunc,degrees:t=>180*t/Math.PI,radians:t=>Math.PI*t/180,acos:Math.acos,acosh:Math.acosh,asin:Math.asin,asinh:Math.asinh,atan:Math.atan,atan2:Math.atan2,atanh:Math.atanh,cos:Math.cos,cosh:Math.cosh,sin:Math.sin,sinh:Math.sinh,tan:Math.tan,tanh:Math.tanh},...At,...{parse_date:t=>null==t?t:new Date(t),parse_float:t=>null==t?t:Number.parseFloat(t),parse_int:(t,e)=>null==t?t:Number.parseInt(t,e),endswith:(t,e,n)=>null!=t&&String(t).endsWith(e,n),match:(t,e,n)=>{const r=null==t?t:String(t).match(e);return null==n||null==r?r:"number"==typeof n?r[n]:r.groups?r.groups[n]:null},normalize:(t,e)=>null==t?t:String(t).normalize(e),padend:(t,e,n)=>null==t?t:String(t).padEnd(e,n),padstart:(t,e,n)=>null==t?t:String(t).padStart(e,n),upper:t=>null==t?t:String(t).toUpperCase(),lower:t=>null==t?t:String(t).toLowerCase(),repeat:(t,e)=>null==t?t:String(t).repeat(e),replace:(t,e,n)=>null==t?t:String(t).replace(e,String(n)),substring:(t,e,n)=>null==t?t:String(t).substring(e,n),split:(t,e,n)=>null==t?[]:String(t).split(e,n),startswith:(t,e,n)=>null!=t&&String(t).startsWith(e,n),trim:t=>null==t?t:String(t).trim()}};function Ct(t){return"bigint"==typeof t}function Ut(t){return void 0===t?t+"":Ct(t)?t+"n":JSON.stringify(t)}function Ft(t,e=[],n=[]){return new Rt(t,D(e),D(n))}class Rt{constructor(t,e,n){this.name=t,this.fields=e,this.params=n}toString(){const t=[...this.fields.map((t=>`d[${Ut(t)}]`)),...this.params.map(Ut)];return`d => op.${this.name}(${t})`}toObject(){return{expr:this.toString(),func:!0}}}const Dt=t=>Ft("any",t),zt=()=>Ft("count"),qt=t=>Ft("array_agg",t),Lt=t=>Ft("array_agg_distinct",t),Pt=(t,e)=>Ft("map_agg",[t,e]),Jt=(t,e)=>Ft("object_agg",[t,e]),Vt=(t,e)=>Ft("entries_agg",[t,e]);var Bt={...It,row_object:(...t)=>Ft("row_object",null,t.flat()),count:zt,any:Dt,array_agg:qt,array_agg_distinct:Lt,object_agg:Jt,map_agg:Pt,entries_agg:Vt,valid:t=>Ft("valid",t),invalid:t=>Ft("invalid",t),distinct:t=>Ft("distinct",t),mode:t=>Ft("mode",t),sum:t=>Ft("sum",t),product:t=>Ft("product",t),mean:t=>Ft("mean",t),average:t=>Ft("average",t),variance:t=>Ft("variance",t),variancep:t=>Ft("variancep",t),stdev:t=>Ft("stdev",t),stdevp:t=>Ft("stdevp",t),min:t=>Ft("min",t),max:t=>Ft("max",t),quantile:(t,e)=>Ft("quantile",t,e),median:t=>Ft("median",t),covariance:(t,e)=>Ft("covariance",[t,e]),covariancep:(t,e)=>Ft("covariancep",[t,e]),corr:(t,e)=>Ft("corr",[t,e]),bins:(t,e,n,r)=>Ft("bins",t,[e,n,r]),row_number:()=>Ft("row_number"),rank:()=>Ft("rank"),avg_rank:()=>Ft("avg_rank"),dense_rank:()=>Ft("dense_rank"),percent_rank:()=>Ft("percent_rank"),cume_dist:()=>Ft("cume_dist"),ntile:t=>Ft("ntile",null,t),lag:(t,e,n)=>Ft("lag",t,[e,n]),lead:(t,e,n)=>Ft("lead",t,[e,n]),first_value:t=>Ft("first_value",t),last_value:t=>Ft("last_value",t),nth_value:(t,e)=>Ft("nth_value",t,e),fill_down:(t,e)=>Ft("fill_down",t,e),fill_up:(t,e)=>Ft("fill_up",t,e)};function Gt(t,e,n,r){const o="map"===r||!0===r?Pt:"entries"===r?Vt:"object"===r?Jt:L('groups option must be "map", "entries", or "object".'),{names:s}=t.groups(),a=function(t,e){t=St(t)?t:new Set(t);let n=e,r=0;for(;t.has(n);)n=e+ ++r;return n}(t.columnNames(),"_");let i=t.select().reify(e).create({data:{[a]:n}}).rollup({[a]:qt(a)});for(let t=s.length;--t>=0;)i=i.groupby(s.slice(0,t)).rollup({[a]:o(s[t],a)});return i.get(a)}const Ht=(t,e)=>{const n=te[t.type];return n?n(t,e):L(`Unsupported expression construct: ${t.type}`)},Wt=(t,e)=>"("+Ht(t.left,e)+" "+t.operator+" "+Ht(t.right,e)+")",Kt=(t,e)=>"("+Qt(t.params,e)+")=>"+Ht(t.body,e),Yt=(t,e)=>Ht(t.callee,e)+"("+Qt(t.arguments,e)+")",Qt=(t,e,n=",")=>t.map((t=>Ht(t,e))).join(n),Zt=t=>t.computed?`[${Ut(t.name)}]`:`.${t.name}`,Xt=(t,e,n)=>{const r=t.table||"";return`data${r}${Zt(t)}.${n}(${e.index}${r})`},te={Constant:t=>t.raw,Column:(t,e)=>Xt(t,e,"get"),Dictionary:(t,e)=>Xt(t,e,"key"),Function:t=>`fn.${t.name}`,Parameter:t=>`$${Zt(t)}`,Op:(t,e)=>`op(${Ut(t.name)},${e.op||e.index})`,Literal:t=>t.raw,Identifier:t=>t.name,TemplateLiteral:(t,e)=>{const{quasis:n,expressions:r}=t,o=r.length;let s=n[0].value.raw;for(let t=0;t<o;)s+="${"+Ht(r[t],e)+"}"+n[++t].value.raw;return"`"+s+"`"},MemberExpression:(t,e)=>{const n=!t.computed,r=Ht(t.object,e),o=Ht(t.property,e);return r+(n?"."+o:"["+o+"]")},CallExpression:Yt,NewExpression:(t,e)=>"new "+Yt(t,e),ArrayExpression:(t,e)=>"["+Qt(t.elements,e)+"]",AssignmentExpression:Wt,BinaryExpression:Wt,LogicalExpression:Wt,UnaryExpression:(t,e)=>"("+t.operator+Ht(t.argument,e)+")",ConditionalExpression:(t,e)=>"("+Ht(t.test,e)+"?"+Ht(t.consequent,e)+":"+Ht(t.alternate,e)+")",ObjectExpression:(t,e)=>"({"+Qt(t.properties,e)+"})",Property:(t,e)=>{const n=Ht(t.key,e);return(t.computed?`[${n}]`:n)+":"+Ht(t.value,e)},ArrowFunctionExpression:Kt,FunctionExpression:Kt,FunctionDeclaration:Kt,ArrayPattern:(t,e)=>"["+Qt(t.elements,e)+"]",ObjectPattern:(t,e)=>"{"+Qt(t.properties,e)+"}",VariableDeclaration:(t,e)=>t.kind+" "+Qt(t.declarations,e,","),VariableDeclarator:(t,e)=>Ht(t.id,e)+"="+Ht(t.init,e),SpreadElement:(t,e)=>"..."+Ht(t.argument,e),BlockStatement:(t,e)=>"{"+Qt(t.body,e,";")+";}",BreakStatement:()=>"break",ExpressionStatement:(t,e)=>Ht(t.expression,e),IfStatement:(t,e)=>"if ("+Ht(t.test,e)+")"+Ht(t.consequent,e)+(t.alternate?" else "+Ht(t.alternate,e):""),SwitchStatement:(t,e)=>"switch ("+Ht(t.discriminant,e)+") {"+Qt(t.cases,e,"")+"}",SwitchCase:(t,e)=>(t.test?"case "+Ht(t.test,e):"default")+": "+Qt(t.consequent,e,";")+";",ReturnStatement:(t,e)=>"return "+Ht(t.argument,e),Program:(t,e)=>Ht(t.body[0],e)};function ee(t,e={index:"row"}){return Ht(t,e)}function ne(t){const e=typeof t;return"string"===e?`"${t}"`:"object"===e&&t?W(t)?+t:R(t)||at(t)?`[${t.map(ne)}]`:Y(t)?t+"":function(t){let e="{",n=-1;for(const r in t)++n>0&&(e+=","),e+=`"${r}":${ne(t[r])}`;return e+="}",e}(t):t}function re(t,e){const n=t.length;return 1===n?(e,n)=>ne(t[0](e,n)):(r,o)=>{let s="";for(let a=0;a<n;++a){a>0&&(s+="|");const n=t[a](r,o);if(e&&(null==n||n!=n))return null;s+=ne(n)}return s}}function oe(){}function se(t){return t.init=t.init||oe,t.add=t.add||oe,t.rem=t.rem||oe,t}function ae(t,e){return t.product_v=!1,t.product=e}var ie={count:{create:()=>se({value:t=>t.count}),param:[]},array_agg:{create:()=>se({init:t=>t.values=!0,value:t=>t.list.values(t.stream)}),param:[1]},object_agg:{create:()=>se({init:t=>t.values=!0,value:t=>Object.fromEntries(t.list.values())}),param:[2]},map_agg:{create:()=>se({init:t=>t.values=!0,value:t=>new Map(t.list.values())}),param:[2]},entries_agg:{create:()=>se({init:t=>t.values=!0,value:t=>t.list.values(t.stream)}),param:[2]},any:{create:()=>se({add:(t,e)=>{null==t.any&&(t.any=e)},value:t=>t.valid?t.any:ot}),param:[1]},valid:{create:()=>se({value:t=>t.valid}),param:[1]},invalid:{create:()=>se({value:t=>t.count-t.valid}),param:[1]},distinct:{create:()=>({init:t=>t.distinct=function(){const t=new Map;return{count:()=>t.size,values:()=>Array.from(t.values(),(t=>t.v)),increment(e){const n=ne(e),r=t.get(n);r?++r.n:t.set(n,{v:e,n:1})},decrement(e){const n=ne(e),r=t.get(n);1===r.n?t.delete(n):--r.n},forEach(e){t.forEach((({v:t,n:n})=>e(t,n)))}}}(),value:t=>t.distinct.count()+(t.valid===t.count?0:1),add:(t,e)=>t.distinct.increment(e),rem:(t,e)=>t.distinct.decrement(e)}),param:[1]},array_agg_distinct:{create:()=>se({value:t=>t.distinct.values()}),param:[1],req:["distinct"]},mode:{create:()=>se({value:t=>{let e=ot,n=0;return t.distinct.forEach(((t,r)=>{r>n&&(n=r,e=t)})),e}}),param:[1],req:["distinct"]},sum:{create:()=>({init:t=>t.sum=0,value:t=>t.valid?t.sum:ot,add:(t,e)=>Ct(e)?0===t.sum?t.sum=e:t.sum+=e:t.sum+=+e,rem:(t,e)=>t.sum-=e}),param:[1]},product:{create:()=>({init:t=>ae(t,1),value:t=>t.valid?t.product_v?ae(t,function(t,e=0,n=t.length){let r=t[e++];for(let o=e;o<n;++o)r*=t[o];return r}(t.list.values())):t.product:void 0,add:(t,e)=>Ct(e)&&1===t.product?t.product=e:t.product*=e,rem:(t,e)=>0==e||e===1/0||e===-1/0?t.product_v=!0:t.product/=e}),param:[1],stream:["array_agg"]},mean:{create:()=>({init:t=>t.mean=0,value:t=>t.valid?t.mean:ot,add:(t,e)=>{t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid},rem:(t,e)=>{t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean}}),param:[1]},average:{create:()=>se({value:t=>t.valid?t.mean:ot}),param:[1],req:["mean"]},variance:{create:()=>({init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):ot,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean)}),param:[1],req:["mean"]},variancep:{create:()=>se({value:t=>t.valid>1?t.dev/t.valid:ot}),param:[1],req:["variance"]},stdev:{create:()=>se({value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):ot}),param:[1],req:["variance"]},stdevp:{create:()=>se({value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):ot}),param:[1],req:["variance"]},min:{create:()=>({init:t=>t.min=ot,value:t=>t.min=Number.isNaN(t.min)?t.list.min():t.min,add:(t,e)=>{(e<t.min||t.min===ot)&&(t.min=e)},rem:(t,e)=>{e<=t.min&&(t.min=NaN)}}),param:[1],stream:["array_agg"]},max:{create:()=>({init:t=>t.max=ot,value:t=>t.max=Number.isNaN(t.max)?t.list.max():t.max,add:(t,e)=>{(e>t.max||t.max===ot)&&(t.max=e)},rem:(t,e)=>{e>=t.max&&(t.max=NaN)}}),param:[1],stream:["array_agg"]},quantile:{create:t=>se({value:e=>e.list.quantile(t)}),param:[1,1],req:["array_agg"]},median:{create:()=>se({value:t=>t.list.quantile(.5)}),param:[1],req:["array_agg"]},covariance:{create:()=>({init:t=>{t.cov=t.mean_x=t.mean_y=t.dev_x=t.dev_y=0},value:t=>t.valid>1?t.cov/(t.valid-1):ot,add:(t,e,n)=>{const r=e-t.mean_x,o=n-t.mean_y;t.mean_x+=r/t.valid,t.mean_y+=o/t.valid;const s=n-t.mean_y;t.dev_x+=r*(e-t.mean_x),t.dev_y+=o*s,t.cov+=r*s},rem:(t,e,n)=>{const r=e-t.mean_x,o=n-t.mean_y;t.mean_x-=t.valid?r/t.valid:t.mean_x,t.mean_y-=t.valid?o/t.valid:t.mean_y;const s=n-t.mean_y;t.dev_x-=r*(e-t.mean_x),t.dev_y-=o*s,t.cov-=r*s}}),param:[2]},covariancep:{create:()=>se({value:t=>t.valid>1?t.cov/t.valid:ot}),param:[2],req:["covariance"]},corr:{create:()=>se({value:t=>t.valid>1?t.cov/(Math.sqrt(t.dev_x)*Math.sqrt(t.dev_y)):ot}),param:[2],req:["covariance"]},bins:{create:(t,e,n,r)=>se({value:o=>function(t,e,n=15,r=!0,o=0,s){const a=Math.LN10;if(null==s){const r=Math.ceil(Math.log(n)/a),i=e-t||Math.abs(t)||1,u=[5,2];for(s=Math.max(o,Math.pow(10,Math.round(Math.log(i)/a)-r));Math.ceil(i/s)>n;)s*=10;const c=u.length;for(let t=0;t<c;++t){const e=s/u[t];e>=o&&i/e<=n&&(s=e)}}if(r){let n=Math.log(s);const r=n>=0?0:1+~~(-n/a),o=Math.pow(10,-r-1);n=Math.floor(t/s+o)*s,t=t<n?n-s:n,e=Math.ceil(e/s)*s}return[t,e===t?t+s:e,s]}(o.min,o.max,t,e,n,r)}),param:[1,4],req:["min","max"]}};const ue={create(){let t;return{init:()=>t=1,value:e=>{const n=e.index;return n&&!e.peer(n)?t=n+1:t}}},param:[]},ce={create(){let t;return{init:()=>t=0,value:e=>{const{index:n,peer:r,size:o}=e;let s=n;if(t<s){for(;s+1<o&&r(s+1);)++s;t=s}return(1+t)/o}}},param:[]};var le={row_number:{create:()=>({init:oe,value:t=>t.index+1}),param:[]},rank:ue,avg_rank:{create(){let t,e;return{init:()=>(t=-1,e=1),value:n=>{const r=n.index;if(r>=t){for(e=t=r+1;n.peer(t);e+=++t);e/=t-r}return e}}},param:[]},dense_rank:{create(){let t;return{init:()=>t=1,value:e=>{const n=e.index;return n&&!e.peer(n)?++t:t}}},param:[]},percent_rank:{create(){const{init:t,value:e}=ue.create();return{init:t,value:t=>(e(t)-1)/(t.size-1)}},param:[]},cume_dist:ce,ntile:{create(t){(t=+t)>0||L("ntile num must be greater than zero.");const{init:e,value:n}=ce.create();return{init:e,value:e=>Math.ceil(t*n(e))}},param:[0,1]},lag:{create:(t,e)=>(t=+t||1,{init:oe,value:(n,r)=>{const o=n.index-t;return o>=0?n.value(o,r):e}}),param:[1,2]},lead:{create:(t,e)=>(t=+t||1,{init:oe,value:(n,r)=>{const o=n.index+t;return o<n.size?n.value(o,r):e}}),param:[1,2]},first_value:{create:()=>({init:oe,value:(t,e)=>t.value(t.i0,e)}),param:[1]},last_value:{create:()=>({init:oe,value:(t,e)=>t.value(t.i1-1,e)}),param:[1]},nth_value:{create:t=>((t=+t)>0||L("nth_value nth must be greater than zero."),{init:oe,value:(e,n)=>{const r=e.i0+(t-1);return r<e.i1?e.value(r,n):ot}}),param:[1,1]},fill_down:{create(t){let e;return{init:()=>e=t,value:(t,n)=>{const r=t.value(t.index,n);return ut(r)?e=r:e}}},param:[1,1]},fill_up:{create(t){let e,n;return{init:()=>(e=t,n=-1),value:(r,o)=>r.index<=n?e:(n=function(t,e,n){for(const r=t.size;n<r;++n)if(ut(t.value(n,e)))return n;return-1}(r,o,r.index))>=0?e=r.value(n,o):(n=r.size,e=t)}},param:[1,1]}};function fe(t){return et(ie,t)}function pe(t){return et(le,t)}function me(t){return et(It,t)||"row_object"===t}function de(t){return fe(t)&&ie[t]}function he(t){return pe(t)&&le[t]}function ge(t,e,n){return t=`"use strict"; return ${t};`,Function("fn","$",t)(e,n)}var ye={escape:(t,e,n)=>ge(t,e,n),expr:(t,e)=>ge(`(row,data,op)=>${t}`,It,e),expr2:(t,e)=>ge(`(row0,data0,row,data)=>${t}`,It,e),join:(t,e)=>ge(`(row1,data1,row2,data2)=>${t}`,It,e),param:(t,e)=>ge(t,It,e)};const _e={"==":1,"!=":1,"===":1,"!==":1};function ve(t,e,n=0,r,o){if(t.type="Column",t.name=e,t.table=n,o&&r&&J(r.keyFor)){const e=_e[o.operator]?o.left===t?o.right:o.left:o.callee&&"equal"===o.callee.name?o.arguments[o.arguments[0]===t?1:0]:null;e&&"Literal"===e.type&&function(t,e,n,r){r<0?(t.type="Literal",t.value=!1,t.raw="false"):(e.type="Dictionary",n.value=r,n.raw=r+"")}(o,t,e,r.keyFor(e.value))}return t}function be(t){return R(t)?t:kt(t)?t.entries():t?Object.entries(t):[]}function we(t,e){t.type="ObjectExpression";const n=t.properties=[];for(const t of be(e)){const[e,r]=R(t)?t:[t,t];n.push({type:"Property",key:{type:"Literal",raw:Ut(r)},value:ve({computed:!0},e)})}return t}function xe(t){return ee(we({},t))}function Me(t){return ye.expr(xe(t))}function je(t,e=1){return(t*e+63&-64||64)/e}function Ee(t,e,n=t.BYTES_PER_ELEMENT){return new t(je(e,n))}function $e(e){return e instanceof t?e:new t(e.type,0,e.length,e.nulls,e.buffers,null,e.dict)}const Oe=new TextEncoder;const ke=Oe.encodeInto?function(t,e,n){return Oe.encodeInto(n,t.subarray(e)).written}:function(t,e,n){const r=Oe.encode(n);return t.set(r,e),r.length};function Se(t,e){const n=Ee(t.ArrayType,e);return{set(t,e){n[e]=t},data:()=>({type:t,length:e,buffers:[null,n]})}}function Ne(t,e){const n=Ee(t.ArrayType,e/8);return{set(t,e){t&&(n[e>>3]|=1<<e%8)},data:()=>({type:t,length:e,buffers:[null,n]})}}function Ae(t,e){const n=Ee(t.ArrayType,e);return{set(t,e){n[e]=t/864e5|0},data:()=>({type:t,length:e,buffers:[null,n]})}}function Te(t,e){const n=Ee(t.ArrayType,e<<1);return{set(t,e){const r=e<<1;n[r]=t%4294967296|0,n[r+1]=t/4294967296|0},data:()=>({type:t,length:e,buffers:[null,n]})}}function Ie(t,e){const n=[],r=Ee(t.indices.ArrayType,e),o=Object.create(null);let s=-1,a=0;return{set(t,e){const i=String(t);let u=o[i];void 0===u&&(a+=i.length,o[i]=u=++s,n.push(i)),r[e]=u},data:()=>({type:t,length:e,buffers:[null,r],dict:Ce(t.dictionary,n,a)})}}function Ce(t,n,r){const o=function(t,e,n){const r=Ee(Int32Array,e+1),o=Ee(Uint8Array,3*n);let s=0;return{set(t,e){s+=ke(o,s,t),r[e+1]=s},data:()=>{const n=je(s),a=o.length>n?o.subarray(0,n):o;return{type:t,length:e,buffers:[r,a]}}}}(t,n.length,r);return n.forEach(o.set),s=o.data(),new e([$e(s)]);var s}function Ue(t,e,o=!0){let s;switch(t.typeId){case r.Int:s=t.bitWidth<64?Se:null;break;case r.Float:s=t.precision>0?Se:null;break;case r.Dictionary:s=t.dictionary.typeId===r.Utf8&&t.indices.typeId===r.Int&&t.indices.bitWidth<64?Ie:null;break;case r.Bool:s=Ne;break;case r.Date:s=t.unit?Te:Ae}return null==s?function(t){const e=n({type:t,nullValues:[null,void 0]});return{set(t,n){e.set(n,t)},data:()=>e.finish().flush()}}(t):o?function(t,e){const n=Ee(Uint8Array,e/8);let r=0;return{set(e,o){null==e?++r:(t.set(e,o),n[o>>3]|=1<<o%8)},data:()=>{const e=t.data();return r&&(e.nulls=r,e.buffers[2]=n),e}}}(s(t,e),e):s(t,e)}function Fe(t,e,n,r,o=!0){const s=Ue(r,t,o);return e(n,s.set),$e(s.data())}function Re(t){if(t instanceof o||null==t)return t;switch(t){case r.Binary:return new k;case r.Bool:return new O;case r.DateDay:return new $;case r.DateMillisecond:case r.Date:return new E;case r.Dictionary:return new j(new s,new _);case r.Float16:return new M;case r.Float32:return new x;case r.Float64:case r.Float:return new w;case r.Int8:return new b;case r.Int16:return new v;case r.Int32:case r.Int:return new _;case r.Int64:return new y;case r.IntervalDayTime:return new g;case r.Interval:case r.IntervalYearMonth:return new h;case r.Null:return new d;case r.TimeMicrosecond:return new m;case r.TimeMillisecond:case r.Time:return new p;case r.TimeNanosecond:return new f;case r.TimeSecond:return new l;case r.Uint8:return new c;case r.Uint16:return new u;case r.Uint32:return new i;case r.Uint64:return new a;case r.Utf8:return new s;default:L(`Unsupported type code: ${Ut(t)}. Use a data type constructor instead?`)}}function De(t,e){const n=ze();return t(e,n.add),n}function ze(){const t={count:0,nulls:0,bools:0,nums:0,ints:0,bigints:0,min:1/0,max:-1/0,digits:0,dates:0,utcdays:0,strings:0,strlen:0,arrays:0,minlen:1/0,maxlen:0,structs:0,add(e){if(++t.count,null==e)return void++t.nulls;const n=typeof e;if("string"===n)++t.strings;else if("number"===n)++t.nums,e<t.min&&(t.min=e),e>t.max&&(t.max=e),Number.isInteger(e)&&++t.ints;else if("boolean"===n)++t.bools;else if("object"===n)if(W(e))++t.dates,0===(r=e).getUTCHours()&&0===r.getUTCMinutes()&&0===r.getUTCSeconds()&&0===r.getUTCMilliseconds()&&++t.utcdays;else if(it(e)){++t.arrays,e.length<t.minlen&&(t.minlen=e.length),e.length>t.maxlen&&(t.maxlen=e.length);const n=t.array_prof||(t.array_prof=ze());e.forEach(n.add)}else{++t.structs;const n=t.struct_prof||(t.struct_prof={});for(const t in e){(n[t]||(n[t]=ze())).add(e[t])}}else"bigint"===n&&(++t.bigints,e<t.min&&(t.min=e),e>t.max&&(t.max=e));var r},type:()=>Re(function(t){const e=t.count-t.nulls;if(0===e)return r.Null;if(t.ints===e){const e=Math.max(Math.abs(t.min)-1,t.max);return t.min<0?e>=2**31?r.Float64:e<128?r.Int8:e<32768?r.Int16:r.Int32:e>=2**32?r.Float64:e<256?r.Uint8:e<65536?r.Uint16:r.Uint32}if(t.nums===e)return r.Float64;if(t.bigints===e){const e=-t.min>t.max?-t.min-1n:t.max;return t.min<0?e<2**63?r.Int64:L(`BigInt exceeds 64 bits: ${e}`):t.max<2**64?r.Uint64:L(`BigInt exceeds 64 bits: ${t.max}`)}if(t.bools===e)return r.Bool;if(t.utcdays===e)return r.DateDay;if(t.dates===e)return r.DateMillisecond;if(t.arrays===e){const e=S.new("value",t.array_prof.type(),!0);return t.minlen===t.maxlen?new N(t.minlen,e):new A(e)}if(t.structs===e){const e=t.struct_prof;return new T(Object.keys(e).map((t=>S.new(t,e[t].type(),!0))))}if(t.strings>0)return r.Dictionary;L("Type inference failure")}(t))};return t}function qe(t,e,n,r,o,s=!0){if(!(o=Re(o))){const t=De(r,e);s=t.nulls>0,o=t.type()}return Fe(n,r,e,o,s)}function Le(t,n,r,o,s,l=!0){s=Re(s);const f=t.column(n),p=!(t.isFiltered()||t.isOrdered()),m=(d=f)instanceof e?d:d.vector instanceof e?d.vector:null;var d;if(m&&p&&Pe(m.type,s))return m;const h=f.data;if(at(h)){const t=function(t){const e={Float32Array:x,Float64Array:w,Int8Array:b,Int16Array:v,Int32Array:_,Uint8Array:c,Uint16Array:u,Uint32Array:i,BigInt64Array:y,BigUint64Array:a}[t.constructor.name];return e?new e:null}(h);if(p&&t&&Pe(t,s))return function(t,e){const n=t.length,r=je(n,t.BYTES_PER_ELEMENT);let o=t;return n!==r&&(o=new t.constructor(r),o.set(t)),$e({type:e,length:n,buffers:[null,o]})}(h,t);s=s||t,l=!1}if(!s){const t=De(o,f);l=t.nulls>0,s=t.type()}return Fe(r,o,f,s,l)}function Pe(t,e){return!t||!e||t.compareTo(e)}function Je(t,e,n){const r=Math.min(t.length,n+e);return(e,o)=>{for(let s=n;s<r;++s)o(t[s][e],s)}}function Ve(t,e,n){const r=0===n&&t.numRows()<=e&&!t.isFiltered()&&!t.isOrdered();return(o,s)=>{let a=-1;r&&it(o.data)?o.data.forEach(s):t.scan((t=>s(o.get(t),++a)),!0,e,n)}}const Be=()=>L("Apache Arrow not imported, see https://github.com/uwdata/arquero#usage");function Ge(t,e={}){const{types:n={}}=e,{dataFrom:r,names:o,nrows:s,scan:a}=function(t,e){const{columns:n,limit:r=1/0,offset:o=0}=e,s=J(n)?n(t):R(n)?n:null;if(R(t))return{dataFrom:qe,names:s||Object.keys(t[0]),nrows:Math.min(r,t.length-o),scan:Je(t,r,o)};if(function(t){return t&&J(t.reify)}(t))return{dataFrom:Le,names:s||t.columnNames(),nrows:Math.min(r,t.numRows()-o),scan:Ve(t,r,o)};L("Unsupported input data type")}(t,e),i={};o.forEach((e=>{const o=r(t,e,s,a,n[e]);o.length!==s&&L("Column length mismatch"),i[e]=o}));return new(function(){try{return I}catch(t){Be()}}())(i)}function He(t,e){return J(e)?e(t):e||t.columnNames()}function We(t,e,n){const r=n.format||{},o=n.align||{},s={},a={};return e.forEach((e=>{const i=function(t,e={}){let n=0,r=0,o=0,s=0,a=0,i=0;return t((t=>{if(++n,null==t)return void++r;const e=typeof t;if("object"===e&&W(t))++o,0===(u=t).getUTCHours()&&0===u.getUTCMinutes()&&0===u.getUTCSeconds()&&0===u.getUTCMilliseconds()&&++s;else if("number"===e&&(++a,t==t&&(0|t)!==t)){const e=t+"",n=e.indexOf(".");if(n>=0){const t=e.indexOf("e"),r=t>0?t:e.length;i=Math.max(i,r-n-1)}}var u})),{align:(r+a+o)/n>.5?"r":"l",format:{utc:o===s,digits:Math.min(i,e.maxdigits||6)}}}(function(t,e){const n=t.column(e);return e=>t.scan((t=>e(n.get(t))))}(t,e),n);a[e]=o[e]||i.align,s[e]=r[e]||i.format})),{align:a,format:s}}function Ke(t,e,n=100,r,o){const s=t.data(),a=e.length;t.scan((t=>{o.row(t);for(let n=0;n<a;++n){const r=e[n];o.cell(s[e[n]].get(t),r,n)}}),!0,n,r)}function Ye(t,e={}){if(J(e))return e(t)+"";const n=typeof t;if("object"===n){if(W(t))return e.utc?ht(t):dt(t);{const n=JSON.stringify(t,((t,e)=>at(e)?Array.from(e):e)),r=e.maxlen||30;return n.length>r?n.slice(0,28)+"…"+("["===n[0]?"]":"}"):n}}if("number"===n){const n=e.digits||0;let r;return 0!==t&&((r=Math.abs(t))>=1e18||r<Math.pow(10,-n))?t.toExponential(n):t.toFixed(n)}return t+""}function Qe(t,e,n={}){for(const r in t)n[r]=e(t[r],r);return n}function Ze(t,e={}){const n=He(t,e.columns),{align:r,format:o}=We(t,n,e),s=function(t){return Qe(t.style,(t=>J(t)?t:()=>t))}(e),a=e.null,i=(t,e)=>Ye(t,e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),u=a?(t,e)=>null==t?a(t):i(t,e):i;let c=-1,l=-1;const f=(t,e,n)=>{const o=n?(t=>"c"===t?"center":"r"===t?"right":"left")(r[e]):"",a=s[t]&&s[t](e,l,c)||"",i=(o?`text-align: ${o};`+(a?" ":""):"")+a;return`<${t}${i?` style="${i}"`:""}>`};let p=f("table")+f("thead")+f("tr",c)+n.map((t=>`${f("th",t,1)}${t}</th>`)).join("")+"</tr></thead>"+f("tbody");return Ke(t,n,e.limit,e.offset,{row(t){c=t,p+=(++l?"</tr>":"")+f("tr")},cell(t,e){p+=f("td",e,1)+u(t,o[e])+"</td>"}}),p+"</tr></tbody></table>"}function Xe(t,e=!0,n=!1){return void 0===t||t?e:n}const tn=t=>W(t)?ht(t,!0):t;function en(t,e){for(const[n,r]of be(e))t.set(n,r);return t}function nn(t){return t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function rn(t,e,n=new Map){return Q(e=P(e)?t.columnName(e):e)?n.set(e,e):R(e)?e.forEach((e=>rn(t,e,n))):J(e)?rn(t,e(t),n):K(e)?en(n,e):L(`Invalid column selection: ${Ut(e)}`),n}function on(t,e){return t.toObject=e,t}function sn(t){return R(t)?t.map(sn):t&&t.toObject?t.toObject():t}function an(){return on((t=>t.columnNames()),(()=>({all:[]})))}function un(...t){return t=t.flat(),on((e=>{const n=rn(e,t);return e.columnNames((t=>!n.has(t)))}),(()=>({not:sn(t)})))}function cn(t,e){return on((n=>{let r=P(t)?t:n.columnIndex(t),o=P(e)?e:n.columnIndex(e);if(o<r){const t=o;o=r,r=t}return n.columnNames().slice(r,o+1)}),(()=>({range:[t,e]})))}function ln(t){return Q(t)&&(t=RegExp(nn(t))),on((e=>e.columnNames((e=>t.test(e)))),(()=>({matches:[t.source,t.flags]})))}function fn(t){return ln(RegExp("^"+nn(t)))}function pn(t){return ln(RegExp(nn(t)+"$"))}class mn extends B{static from(t,e){return new mn(Z(t,e),e)}static new(t,e){if(t instanceof mn)return t;const n={},r=[];for(const[e,o]of be(t))n[e]=o,r.push(e);return new mn(n,e||r)}constructor(t,e,n,r,o,s){Qe(t,H,t);super(e=e||Object.keys(t),e.length?t[e[0]].length:0,t,n,r,o,s)}create({data:t,names:e,filter:n,groups:r,order:o}){const s=void 0!==n?n:this.mask();return new mn(t||this._data,e||(t?null:this._names),s,void 0!==r?r:function(t,e){if(!t||!e)return t;const{keys:n,rows:r,size:o}=t,s=new Int32Array(o);e.scan((t=>s[n[t]]=1));const a=s.reduce(((t,e)=>t+e),0);if(a===o)return t;const i=Array(a);let u=0;for(let t=0;t<o;++t)s[t]&&(i[s[t]=u++]=r[t]);const c=new Uint32Array(n.length);return e.scan((t=>c[t]=s[n[t]])),{...t,keys:c,rows:i,size:u}}(this._group,n&&s),void 0!==o?o:this._order,this._params)}assign(...t){const e=this.numRows(),n=this.reify(),r=nt(n).groupby(n.groups());return t.forEach((t=>{(t=mn.new(t)).numRows()!==e&&L("Assign row counts do not match"),(t=t.reify()).columnNames((e=>r.add(e,t.column(e))))})),this.create(r.new())}columns(){return this._data}column(t){return this._data[t]}columnAt(t){return this._data[this._names[t]]}array(t,e=Array){const n=this.column(t),r=new e(this.numRows());let o=-1;return this.scan((t=>r[++o]=n.get(t)),!0),r}get(t,e=0){const n=this.column(t);return this.isFiltered()||this.isOrdered()?n.get(this.indices()[e]):n.get(e)}getter(t){const e=this.column(t),n=this.isFiltered()||this.isOrdered()?this.indices():null;return n?t=>e.get(n[t]):e?t=>e.get(t):L(`Unrecognized column: ${t}`)}object(t=0){return dn(this)(t)}objects(t={}){const{grouped:e,limit:n,offset:r}=t,o=Me(rn(this,t.columns||an())),s=[];if(this.scan(((t,e)=>s.push(o(t,e))),!0,n,r),e&&this.isGrouped()){const t=[];return this.scan((e=>t.push(e)),!0,n,r),Gt(this,t,s,e)}return s}*[Symbol.iterator](){const t=dn(this),e=this.numRows();for(let n=0;n<e;++n)yield t(n)}reify(t){const e=t?t.length:this.numRows(),n=this._names;let r,o;if(!t&&!this.isOrdered()){if(!this.isFiltered())return this;e===this.totalRows()&&(r=this.data())}if(!r){const a=t?e=>t.forEach(e):t=>this.scan(t,!0),i=n.length;r={};for(let t=0;t<i;++t){const o=n[t],i=this.column(o),u=r[o]=new(at((s=i).data)?s.data.constructor:Array)(e);let c=-1;a((t=>u[++c]=i.get(t)))}this.isGrouped()&&(o=function(t,e,n,r){const{keys:o,rows:s,size:a}=t;let i=s,u=a,c=null;if(n){c=new Int32Array(a),e((t=>c[o[t]]=1));const t=c.reduce(((t,e)=>t+e),0);if(t!==a){i=Array(t),u=0;for(let t=0;t<a;++t)c[t]&&(i[c[t]=u++]=s[t])}}let l=-1;const f=new Uint32Array(r);return e(u!==a?t=>f[++l]=c[o[t]]:t=>f[++l]=o[t]),{...t,keys:f,rows:i,size:u}}(this.groups(),a,!!t,e))}var s;return this.create({data:r,names:n,groups:o,filter:null,order:null})}transform(...t){return t.flat().reduce(((t,e)=>e(t)),this)}toArrow(t){return Ge(this,t)}toArrowBuffer(t){return function(t,e){return U(Ge(t,e))}(this,t)}toCSV(t){return function(t,e={}){const n=He(t,e.columns),r=e.format||{},o=e.delimiter||",",s=new RegExp(`["${o}\n\r]`),a=t=>null==t?"":W(t)?ht(t,!0):s.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t,i=n.map(a);let u="";return Ke(t,n,e.limit||1/0,e.offset,{row(){u+=i.join(o)+"\n"},cell(t,e,n){i[n]=a(r[e]?r[e](t):t)}}),u+i.join(o)}(this,t)}toHTML(t){return Ze(this,t)}toJSON(t){return function(t,e={}){const n=Xe(e.schema),r=e.format||{},o=He(t,e.columns);let s="{";return n&&(s+='"schema":{"fields":'+JSON.stringify(o.map((t=>({name:t}))))+'},"data":{'),o.forEach(((n,o)=>{s+=(o?",":"")+JSON.stringify(n)+":[";const a=t.column(n),i=r[n]||tn;let u=-1;t.scan((t=>{const e=a.get(t);s+=(++u?",":"")+JSON.stringify(i(e))}),!0,e.limit,e.offset),s+="]"})),s+"}"+(n?"}":"")}(this,t)}toMarkdown(t){return function(t,e={}){const n=He(t,e.columns),{align:r,format:o}=We(t,n,e),s=t=>t.replace(/\|/g,"\\|");let a="|"+n.map(s).join("|")+"|\n|"+n.map((t=>{return"c"===(e=r[t])?":-:":"r"===e?"-:":":-";var e})).join("|")+"|";return Ke(t,n,e.limit,e.offset,{row(){a+="\n|"},cell(t,e){a+=s(Ye(t,o[e]))+"|"}}),a+"\n"}(this,t)}}function dn(t){let e=t._builder;if(!e){const n=Me(t.columnNames()),r=t.data();if(t.isOrdered()||t.isFiltered()){const o=t.indices();e=t=>n(o[t],r)}else e=t=>n(t,r);t._builder=e}return e}class hn{constructor(t){this._outputs=t}size(){return this._outputs.length}outputs(){return this._outputs}init(){return{}}add(){}rem(){}write(){}}function gn(t,e,n,r){const o=n[t.type]||n.Default;if(o&&!1===o(t,e,r))return;const s=Mn[t.type];s&&s(t,e,n)}const yn=(t,e,n)=>{gn(t.argument,e,n,t)},_n=(t,e,n)=>{gn(t.left,e,n,t),gn(t.right,e,n,t)},vn=(t,e,n)=>{gn(t.test,e,n,t),gn(t.consequent,e,n,t),t.alternate&&gn(t.alternate,e,n,t)},bn=(t,e,n)=>{xn(t.params,e,n,t),gn(t.body,e,n,t)},wn=(t,e,n)=>{gn(t.callee,e,n,t),xn(t.arguments,e,n,t)},xn=(t,e,n,r)=>{t.forEach((t=>gn(t,e,n,r)))},Mn={TemplateLiteral:(t,e,n)=>{xn(t.expressions,e,n,t),xn(t.quasis,e,n,t)},MemberExpression:(t,e,n)=>{gn(t.object,e,n,t),gn(t.property,e,n,t)},CallExpression:wn,NewExpression:wn,ArrayExpression:(t,e,n)=>{xn(t.elements,e,n,t)},AssignmentExpression:_n,AwaitExpression:yn,BinaryExpression:_n,LogicalExpression:_n,UnaryExpression:yn,UpdateExpression:yn,ConditionalExpression:vn,ObjectExpression:(t,e,n)=>{xn(t.properties,e,n,t)},Property:(t,e,n)=>{gn(t.key,e,n,t),gn(t.value,e,n,t)},ArrowFunctionExpression:bn,FunctionExpression:bn,FunctionDeclaration:bn,VariableDeclaration:(t,e,n)=>{xn(t.declarations,e,n,t)},VariableDeclarator:(t,e,n)=>{gn(t.id,e,n,t),gn(t.init,e,n,t)},SpreadElement:(t,e,n)=>{gn(t.argument,e,n,t)},BlockStatement:(t,e,n)=>{xn(t.body,e,n,t)},ExpressionStatement:(t,e,n)=>{gn(t.expression,e,n,t)},IfStatement:vn,ForStatement:(t,e,n)=>{gn(t.init,e,n,t),gn(t.test,e,n,t),gn(t.update,e,n,t),gn(t.body,e,n,t)},WhileStatement:(t,e,n)=>{gn(t.test,e,n,t),gn(t.body,e,n,t)},DoWhileStatement:(t,e,n)=>{gn(t.body,e,n,t),gn(t.test,e,n,t)},SwitchStatement:(t,e,n)=>{gn(t.discriminant,e,n,t),xn(t.cases,e,n,t)},SwitchCase:(t,e,n)=>{t.test&&gn(t.test,e,n,t),xn(t.consequent,e,n,t)},ReturnStatement:yn,Program:(t,e,n)=>{gn(t.body[0],e,n,t)}};function jn(t){delete t.start,delete t.end,delete t.optional}function En(t){jn(t),delete t.object,delete t.property,delete t.computed,t.table||delete t.table}function $n(t,e){return e&&e.type===t}function On(t,e,n){t.aggronly&&L("Escaped functions are not valid as rollup or pivot values.");const r="(row,data)=>fn("+xe(t.table.columnNames())+",$)";return{escape:ye.escape(r,(o=e.expr,J(o)?o:()=>o),n)};var o}var kn={undefined:"void(0)",Infinity:"Number.POSITIVE_INFINITY",NaN:"Number.NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"};const Sn={ecmaVersion:11},Nn=t=>(e,n)=>n.error(e,t+" not allowed"),An=Nn("Aggregate function"),Tn=Nn("Window function"),In="Invalid column reference",Cn="Table expressions do not support closures",Un="Use aq.escape(fn) to use a function as-is (including closures)",Fn=`\nNote: ${Cn}. ${Un}, or use table.params({ name: value }) to define dynamic parameters.`,Rn=`\nNote: ${Cn}. ${Un}, or use aq.addFunction(name, fn) to add new op functions.`;function Dn(t,e){const n=function(t){try{const e=t.field?function(t){const e=JSON.stringify(t+"");return t.table?`(a,b)=>b[${e}]`:`d=>d[${e}]`}(t):R(t)?Ut(t):t;return F(`expr=(${e})`,Sn).body[0].expression.right}catch(e){L("Expression parse error: "+(t+""))}}(e);let r=t.root=n;return t.spec=e,t.tuple=null,t.tuple1=null,t.tuple2=null,t.$param=null,t.$op=0,t.scope=new Set,t.paramsRef=new Map,t.columnRef=new Map,!function(t){return $n("FunctionExpression",t)||$n("ArrowFunctionExpression",t)}(r)?t.join?(t.scope.add(t.tuple1="d1"),t.scope.add(t.tuple2="d2"),t.scope.add(t.$param="$")):(t.scope.add(t.tuple="d"),t.scope.add(t.$param="$")):(!function(t,e){t.generator&&Nn("Generator functions")(t,e);t.async&&Nn("Async functions")(t,e);const{params:n}=t,r=n.length,o=t=>(n,r)=>e.columnRef.set(n,[r,t]),s=(t,n)=>e.paramsRef.set(t,n);r&&(e.join?(Pn(e,n[0],"tuple1",o(1)),r>1&&Pn(e,n[1],"tuple2",o(2)),r>2&&Pn(e,n[2],"$param",s)):(Pn(e,n[0],"tuple",o(0)),r>1&&Pn(e,n[1],"$param",s)));e.root=t.body}(r,t),r=r.body),gn(r,t,zn),t.root}const zn={FunctionDeclaration:Nn("Function definitions"),ForStatement:Nn("For loops"),ForOfStatement:Nn("For-of loops"),ForInStatement:Nn("For-in loops"),WhileStatement:Nn("While loops"),DoWhileStatement:Nn("Do-while loops"),AwaitExpression:Nn("Await expressions"),ArrowFunctionExpression:Nn("Function definitions"),AssignmentExpression:Nn("Assignments"),FunctionExpression:Nn("Function definitions"),NewExpression:Nn('Use of "new"'),UpdateExpression:Nn("Update expressions"),VariableDeclarator(t,e){Zn(t.id,e)},Identifier(t,e,n){Bn(t,e,n)&&!e.scope.has(t.name)&&e.error(t,"Invalid variable reference",Fn)},CallExpression(t,e){const n=Jn(t.callee),r=de(n)||he(n);if(r){if((e.join||!1===e.aggregate)&&fe(n)&&An(t,e),(e.join||!1===e.window)&&pe(n)&&Tn(t,e),e.$op=1,e.ast)Qn(t,n,e),t.arguments.forEach((t=>gn(t,e,Ln)));else{const o=e.op(function(t,e,n,r){const o=[],s=[],a=e.param[0]||0,i=a+(e.param[1]||0);return r.forEach(((e,n)=>{n<a?(gn(e,t,Ln),o.push(t.field(e))):n<i?(gn(e,t,Ln),s.push(t.param(e))):t.error(e,"Invalid operator parameter")})),{name:n,fields:o,params:s,...t.spec.window||{}}}(e,r,n,t.arguments));Object.assign(t,{type:"Op",name:o.id})}return e.$op=0,!1}me(n)?Qn(t,n,e):e.error(t,"Invalid function call",Rn)},MemberExpression(t,e,n){const{object:r,property:o}=t;if(!$n("Identifier",r))return;const{name:s}=r;if(Vn(t)&&$n("Identifier",o)&&et(kn,o.name))return void Yn(t,o.name);const a=s===e.tuple?0:s===e.tuple1?1:s===e.tuple2?2:-1;return a>=0?qn(t,a,e,Gn,n):s===e.$param?qn(t,a,e,Wn):void(e.paramsRef.has(s)?Kn(t,e.paramsRef.get(s)):e.columnRef.has(s)?Hn(r,s,e,t):et(e.params,s)&&Kn(r,s))}};function qn(t,e,n,r,o){const{property:s,computed:a}=t;let i;if(a)if($n("Literal",s))i=s.value;else try{i=n.param(s)}catch(e){n.error(t,"Invalid member expression")}else i=s.name;return r(t,i,e,n,o),!1}const Ln={...zn,VariableDeclarator:Nn("Variable declaration in operator call"),Identifier(t,e,n){Bn(t,e,n)&&e.error(t,"Variable not accessible in operator call")},CallExpression(t,e){const n=Jn(t.callee);me(n)?Qn(t,n,e):e.error(t,"Invalid function call",Rn)}};function Pn(t,e,n,r){$n("Identifier",e)?(t.scope.add(e.name),t[n]=e.name):$n("ObjectPattern",e)&&e.properties.forEach((e=>{const n=$n("Identifier",e.key)?e.key.name:$n("Literal",e.key)?e.key.value:t.error(e,"Invalid argument");$n("Identifier",e.value)||t.error(e.value,"Unsupported destructuring pattern"),r(e.value.name,n)}))}function Jn(t){return $n("Identifier",t)?t.name:$n("MemberExpression",t)?Vn(t)?function(t){return"max"===t?"greatest":"min"===t?"least":t}(t.property.name):t.property.name:null}function Vn(t){return $n("Identifier",t.object)&&"Math"===t.object.name}function Bn(t,e,n){const{name:r}=t;if($n("MemberExpression",n)&&n.property===t);else if($n("Property",n)&&n.key===t);else if(e.paramsRef.has(r))Kn(t,e.paramsRef.get(r));else if(e.columnRef.has(r))Hn(t,r,e,n);else if(et(e.params,r))Kn(t,r);else{if(!et(kn,r))return!0;Yn(t,r)}}function Gn(t,e,n,r,o){const s=0===n?r.table:n>0?r.join[n-1]:null,a=s&&s.column(e);s&&!a&&r.error(t,In),r.aggronly&&!r.$op&&r.error(t,"Invalid column reference (must be input to an aggregate function)"),ve(t,e,n,a,o)}function Hn(t,e,n,r){const[o,s]=n.columnRef.get(e);Gn(t,o,s,n,r)}function Wn(t,e,n,r){r.params&&!et(r.params,e)&&r.error(t,"Invalid param reference"),Kn(t,e)}function Kn(t,e){t.type="Parameter",t.name=e}function Yn(t,e){t.type="Constant",t.name=e,t.raw=kn[e]}function Qn(t,e,n){if("row_object"===e){const e=n.table;e||n.error(t,"The row_object method is not valid in multi-table expressions."),we(t,t.arguments.length?t.arguments.map((t=>{const r=n.param(t),o=P(r)?e.columnName(r):r;return e.column(o)||n.error(t,In),o})):e.columnNames())}else t.callee={type:"Function",name:e}}function Zn(t,e){$n("Identifier",t)?e.scope.add(t.name):$n("ArrayPattern",t)?t.elements.forEach((t=>Zn(t,e))):$n("ObjectPattern",t)?t.properties.forEach((t=>Zn(t.value,e))):e.error(t.id,"Unsupported variable declaration")}const Xn={Column:1,Op:1};function tr(t,e={}){const n=e.generate||ee,r=e.compiler||ye,o=function(t){return(t.table?er(t.table):t.join?{...er(t.join[1]),...er(t.join[0])}:{})||{}}(e),s={},a={},i=[],u=[];let c=0,l=-1;const f=e.join?r.join:1==e.index?r.expr2:r.expr,p={op(t){const e=function(t){let e=`${t.name}(${t.fields.concat(t.params).join(",")})`;if(t.frame){e+=`[${t.frame.map((t=>Number.isFinite(t)?Math.abs(t):-1))},${!!t.peers}]`}return e}(t);return a[e]||(t.id=++l,a[e]=t)},field(t){const e=n(t);return s[e]||(s[e]=++c)},param:t=>$n("Literal",t)?t.value:r.param(n(t),o),value(t,r){i.push(t);const s=r.escape||(e.ast?function(t){return gn(t,null,{Column:En,Constant:En,Default:jn}),t}(r):f(n(r),o));u.push(s),Xn[r.type]&&s!==r&&K(s)&&(s.field=r.name)},error(t,e,n=""){const r=t.start-6,o=t.end-6;L(`${e}: "${String(p.spec).slice(r,o)}"${n}`)}};Object.assign(p,e,{params:o});for(const[e,n]of be(t))p.value(e+"",n.escape?On(p,n,o):Dn(p,n));if(e.ast)return{names:i,exprs:u};const m=[];for(const t in s)m[s[t]]=r.expr(t,o);const d=Object.values(a);return d.forEach((t=>t.fields=t.fields.map((t=>m[t])))),{names:i,exprs:u,ops:d}}function er(t){return t&&J(t.params)?t.params():{}}const nr="ExprList",rr="Options";function or(t,e){return t&&t.expr?new sr({...t,...e}):new sr(e,t)}class sr{constructor(t,e){this.expr=e,Object.assign(this,t)}toString(){return String(this.expr)}toObject(){return{...this,expr:this.toString(),...J(this.expr)?{func:!0}:{}}}}function ar(t){return or(t,{desc:!0})}function ir(t,e,n=0){const r=n?{field:!0,table:n}:{field:!0};return or(t,e?{expr:e,...r}:r)}function ur(t,e,n){return or(t,{window:{frame:e||[-1/0,0],peers:!!n}})}function cr(t,e){return(e=e&&J(e.query)?e.query():e)&&J(e.evaluate)?e.evaluate(null,t):t(e)}function lr(t){return K(t)&&(R(t.all)||R(t.matches)||R(t.not)||R(t.range))}function fr(t){return t&&J(t.toObject)?t.toObject():J(t)?{expr:String(t),func:!0}:R(t)?t.map(fr):K(t)?Qe(t,(t=>fr(t))):t}function pr(t){return R(t)?t.map(pr):K(t)?R(t.verbs)?Nr.from(t):R(t.all)?an():R(t.range)?cn(...t.range):R(t.match)?ln(RegExp(...t.match)):R(t.not)?un(t.not.map(fr)):function(t){let e=t,n=t.expr;if(null!=n){if(!0===t.field?e=n=ir(n):!0===t.func&&(e=n=function(t){const e=t=>t;return e.toString=()=>t,e}(n)),K(t.window)){const{frame:r,peers:o}=t.window;e=n=ur(n,r,o)}!0===t.desc&&(e=ar(n))}return t===e?Qe(t,(t=>pr(t))):e}(t):t}function mr(t){const e=[];return D(t).forEach((t=>{P(t)?e.push(t):Q(t)?e.push(ir(t,null)):K(t)&&t.expr||J(t)?e.push(t):L("Invalid key value: "+(t+""))})),e}function dr(t,e){return e<2?D(t):t}const hr={Expr:xr,[nr]:Mr,ExprNumber:function(t){return P(t)?t:vr(t)},ExprObject:vr,JoinKeys:function(t){return R(t)?t.map(Mr):vr(t,{join:!0})},JoinValues:function(t){return R(t)?t.map(((t,e)=>e<2?Mr(t):vr(t,{join:!0}))):vr(t,{join:!0})},OrderKeys:Mr,SelectionList:function(t){return D(t).map(wr).flat()}};function gr(t,e,n){return e===rr?t?function(t,e={}){const n={};for(const r in t){const o=t[r];n[r]=e[r]?gr(o,e[r]):o}return n}(t,n):t:hr[e](t)}function yr(t){return{type:"Column",name:t}}function _r(t){return{type:"Column",index:t}}function vr(t,e){if(Q(t))return function(t,e){return tr({expr:t},{...e,ast:!0}).exprs[0]}(t,e);if(t.expr){let n;if(!0===t.field?n=yr(t.expr):!0===t.func&&(n=vr(t.expr,e)),n)return t.desc&&(n={type:"Descending",expr:n}),t.window&&(n={type:"Window",expr:n,...t.window}),n}return Object.keys(t).map((n=>({...vr(t[n],e),as:n})))}function br(t){const e="Selection";return t.all?{type:e,operator:"all"}:t.not?{type:e,operator:"not",arguments:Mr(t.not)}:t.range?{type:e,operator:"range",arguments:Mr(t.range)}:t.matches?{type:e,operator:"matches",arguments:t.matches}:L("Invalid input")}function wr(t){return lr(t)?br(t):P(t)?_r(t):Q(t)?yr(t):K(t)?Object.keys(t).map((e=>({type:"Column",name:e,as:t[e]}))):L("Invalid input")}function xr(t){return lr(t)?br(t):P(t)?_r(t):Q(t)?yr(t):K(t)?vr(t):L("Invalid input")}function Mr(t){return D(t).map(xr).flat()}function jr(t){return t&&J(t.toAST)?t.toAST():t}class Er{constructor(t,e=[],n=[]){this.verb=t,this.schema=e,e.forEach(((t,e)=>{const r=t.type,o=n[e],s="JoinKeys"===r?R(a=o)?a.map(mr):a:"JoinValues"===r?function(t){return R(t)?t.map(dr):t}(o):"OrderKeys"===r?function(t){const e=[];return t.forEach((t=>{const n=null!=t.expr?t.expr:t;if(K(n)&&!J(n))for(const t in n)e.push(n[t]);else t=P(n)?n:Q(n)?ir(t):J(n)?t:L("Invalid orderby field: "+t),e.push(t)})),e}(o):o;var a;this[t.name]=void 0!==s?s:t.default}))}static from(t){const e=Or[t.verb],n=(e.schema||[]).map((({name:e})=>pr(t[e])));return e(...n)}evaluate(t,e){const n=this.schema.map((({name:t,type:n})=>{const r=this[t];return"TableRef"===n?cr(e,r):"TableRefList"===n?r.map((t=>cr(e,t))):r}));return t[this.verb](...n)}toObject(){const t={verb:this.verb};return this.schema.forEach((({name:e})=>{t[e]=fr(this[e])})),t}toAST(){const t={type:"Verb",verb:this.verb};return this.schema.forEach((({name:e,type:n,props:r})=>{t[e]=function(t,e,n){return"TableRef"===e?jr(t):"TableRefList"===e?t.map(jr):gr(fr(t),e,n)}(this[e],n,r)})),t}}function $r(t,e){return Object.assign(((...n)=>new Er(t,e,n)),{schema:e})}const Or={count:$r("count",[{name:"options",type:rr}]),derive:$r("derive",[{name:"values",type:"ExprObject"},{name:"options",type:rr,props:{before:"SelectionList",after:"SelectionList"}}]),filter:$r("filter",[{name:"criteria",type:"ExprObject"}]),groupby:$r("groupby",[{name:"keys",type:nr}]),orderby:$r("orderby",[{name:"keys",type:"OrderKeys"}]),relocate:$r("relocate",[{name:"columns",type:"SelectionList"},{name:"options",type:rr,props:{before:"SelectionList",after:"SelectionList"}}]),rename:$r("rename",[{name:"columns",type:"SelectionList"}]),rollup:$r("rollup",[{name:"values",type:"ExprObject"}]),sample:$r("sample",[{name:"size",type:"ExprNumber"},{name:"options",type:rr,props:{weight:"Expr"}}]),select:$r("select",[{name:"columns",type:"SelectionList"}]),ungroup:$r("ungroup"),unorder:$r("unorder"),reify:$r("reify"),dedupe:$r("dedupe",[{name:"keys",type:nr,default:[]}]),impute:$r("impute",[{name:"values",type:"ExprObject"},{name:"options",type:rr,props:{expand:nr}}]),fold:$r("fold",[{name:"values",type:nr},{name:"options",type:rr}]),pivot:$r("pivot",[{name:"keys",type:nr},{name:"values",type:nr},{name:"options",type:rr}]),spread:$r("spread",[{name:"values",type:nr},{name:"options",type:rr}]),unroll:$r("unroll",[{name:"values",type:nr},{name:"options",type:rr,props:{drop:nr}}]),lookup:$r("lookup",[{name:"table",type:"TableRef"},{name:"on",type:"JoinKeys"},{name:"values",type:nr}]),join:$r("join",[{name:"table",type:"TableRef"},{name:"on",type:"JoinKeys"},{name:"values",type:"JoinValues"},{name:"options",type:rr}]),cross:$r("cross",[{name:"table",type:"TableRef"},{name:"values",type:"JoinValues"},{name:"options",type:rr}]),semijoin:$r("semijoin",[{name:"table",type:"TableRef"},{name:"on",type:"JoinKeys"}]),antijoin:$r("antijoin",[{name:"table",type:"TableRef"},{name:"on",type:"JoinKeys"}]),concat:$r("concat",[{name:"tables",type:"TableRefList"}]),union:$r("union",[{name:"tables",type:"TableRefList"}]),intersect:$r("intersect",[{name:"tables",type:"TableRefList"}]),except:$r("except",[{name:"tables",type:"TableRefList"}])};function kr(t){return new Nr(null,null,t)}function Sr(t){return Nr.from(t)}class Nr extends q{constructor(t,e,n){super(e),this._verbs=t||[],this._table=n}static from({verbs:t,table:e,params:n}){return new Nr(t.map(Er.from),n,e)}get[Symbol.toStringTag](){if(!this._verbs)return"Object";return`Query: ${this._verbs.length} verbs`+(this._table?` on '${this._table}'`:"")}get length(){return this._verbs.length}get tableName(){return this._table}params(t){return arguments.length?(this._params={...this._params,...t},this):this._params}evaluate(t,e){t=t||e(this._table);for(const n of this._verbs)t=n.evaluate(t.params(this._params),e);return t}toObject(){return Ar(this,"toObject")}toJSON(){return this.toObject()}toAST(){return Ar(this,"toAST",{type:"Query"})}}function Ar(t,e,n){return{...n,verbs:t._verbs.map((t=>t[e]())),...t._params?{params:t._params}:null,...t._table?{table:t._table}:null}}function Tr(t,e){return new Nr(t._verbs.concat(e),t._params,t._table)}for(const t in Or){const e=Or[t];Nr.prototype["__"+t]=function(t,...n){return Tr(t,e(...n))}}var Ir="5.1.0";function Cr(t){const{data:e,length:n,nullCount:r}=t,o=e[e.length-1].dictionary,s=o.length,a=function(t,e,n,r){const o=t.length>1||n?function(t,e,n){const r=new n.ArrayType(e),o=t.length;for(let e,n=0,s=0;n<o;++n)e=t[n].length,r.set(t[n].values.subarray(0,e),s),s+=e;return r}(t,e,t[0].type.indices):t[0].values;return n?function(t,e,n){const r=t.length;for(let o,s,a,i,u=0,c=0;u<r;++u){if(a=t[u].nullBitmap,o=t[u].length>>3,a&&a.length)for(let t=0;t<=o;++t)255!==(i=a[t])&&(s=c+(t<<3),0==(1&i)&&(e[s+0]=n),0==(2&i)&&(e[s+1]=n),0==(4&i)&&(e[s+2]=n),0==(8&i)&&(e[s+3]=n),0==(16&i)&&(e[s+4]=n),0==(32&i)&&(e[s+5]=n),0==(64&i)&&(e[s+6]=n),0==(128&i)&&(e[s+7]=n));c+=t[u].length}return e}(t,o,r):o}(e||[t],n,r,s),i=Array(s),u=t=>null==t||t<0||t>=s?null:void 0!==i[t]?i[t]:i[t]=o.get(t);return{vector:t,length:n,get:t=>u(a[t]),key:t=>a[t],keyFor(t){if(null===t)return r?s:-1;for(let e=0;e<s;++e)if(void 0===i[e]&&(i[e]=o.get(e)),i[e]===t)return e;return-1},groups(t){const e=s+(r?1:0);return{keys:a,get:[u],names:t,rows:Tt(0,e),size:e}},[Symbol.iterator]:()=>t[Symbol.iterator]()}}function Ur(t,e,...n){const r=["_","$"],o=r.slice(0,n.length);return o.push('"use strict"; const '+n.map(((t,e)=>t.map(((t,n)=>`${r[e]}${n} = ${r[e]}[${n}]`)).join(", "))).join(", ")+`; return (${t}) => ${e};`),Function(...o)(...n)}function Fr(t,e){const{type:n,length:r,numChildren:o}=t;if((({typeId:t})=>-1===t)(n))return Cr(t);const s=o&&e?zr(t):o?Rr(zr(t)):(({typeId:t})=>5===t)(n)?Rr((e=>t.get(e))):null;return s?{vector:t,length:r,get:s,[Symbol.iterator]:()=>function*(t,e){for(let n=0;n<t;++n)yield e(n)}(r,s)}:t}function Rr(t){const e=[];return n=>{const r=e[n];return void 0!==r?r:e[n]=t(n)}}const Dr=t=>t.numChildren?V(t.length,zr(t)):t.nullCount?[...t]:t.toArray(),zr=t=>{return(({typeId:t})=>12===t)(e=t.type)||(({typeId:t})=>16===t)(e)?qr(t):(({typeId:t})=>13===t)(t.type)?function(t){const e=[],n=[];t.type.children.forEach(((r,o)=>{e.push(Fr(t.getChildAt(o),!0)),n.push(`${Ut(r.name)}:_${o}.get(row)`)}));const r=Ur("row","({"+n+"})",e);return t.nullCount?e=>t.isValid(e)?r(e):null:r}(t):L(`Unsupported Arrow type: ${Ut(t.VectorName)}`);var e},qr=t=>t.nullCount?e=>t.isValid(e)?Dr(t.get(e)):null:e=>Dr(t.get(e));function Lr(t,e={}){t&&!t.batches&&(t=function(){try{return C}catch(t){Be()}}()(t));const n=t.schema.fields.map((t=>t.name)),r=rn({columnNames:t=>t?n.filter(t):n.slice(),columnIndex:t=>n.indexOf(t)},e.columns||an()),o=nt();return r.forEach(((e,n)=>{o.add(e,Fr(t.getChild(n)))})),new mn(o.data,o.names)}var Pr=t=>t;const Jr=[t=>"true"===t||"false"===t,t=>"false"!==t],Vr=[t=>"NaN"===t||(t=+t)===t,t=>+t],Br=[yt,t=>new Date(Date.parse(t))];function Gr(t){const{decimal:e}=t;return e&&"."!==e?Vr.map((t=>n=>t(n&&n.replace(e,".")))):Vr}function Hr(t,e){const n=t.length;for(let r=0;r<n;++r){const n=t[r];if(null!=n&&!e(n))return!1}return!0}function Wr(t,e=0){return V(t-e,(t=>`col${t+e+1}`))}function Kr(t,e,n){let r=t();const o=r.length,s=+n.autoMax||1e3,a=V(o,(()=>[]));e=e?e.length<o?[...e,Wr(o,e.length)]:e:Wr(o);let i=0;for(;i<s&&r;++i,r=t())for(let t=0;t<o;++t)a[t].push(""===r[t]?null:r[t]);const u=function(t,e,n){const{parse:r={}}=n,o=!1===n.autoType;return t.map(((t,s)=>J(r[t])?r[t]:o?Pr:function(t,e){const n=[Jr,Gr(e),Br],r=n.length;for(let e=0;e<r;++e){const[r,o]=n[e];if(Hr(t,r))return o}return Pr}(e[s],n)))}(e,a,n);for(u.forEach(((t,e)=>{if(t===Pr)return;const n=a[e];for(let e=0;e<i;++e)null!=n[e]&&(n[e]=t(n[e]))}));r;r=t())for(let t=0;t<o;++t)a[t].push(r[t]?u[t](r[t]):null);const c={};return e.forEach(((t,e)=>c[t]=a[e])),new mn(c,e)}const Yr={},Qr={};function Zr(t,e,n){let r=+e||0;for(;--r>=0;)t();return n?()=>{let e;for(;!e;){if(!n(e=t()))return e;e=null}}:t}function Xr(t,e={}){const n=function(t,{delimiter:e=",",skip:n,comment:r}){1!==e.length&&L(`Text "delimiter" should be a single character, found "${e}"`);const o=e.charCodeAt(0);let s,a=t.length,i=0,u=a<=0,c=!1;function l(){if(u)return Qr;if(c)return c=!1,Yr;const e=i;let n,r;if(34===t.charCodeAt(e)){for(;i++<a&&34!==t.charCodeAt(i)||34===t.charCodeAt(++i););return(n=i)>=a?u=!0:10===(r=t.charCodeAt(i++))?c=!0:13===r&&(c=!0,10===t.charCodeAt(i)&&++i),t.slice(e+1,n-1).replace(/""/g,'"')}for(;i<a;){if(10===(r=t.charCodeAt(n=i++)))c=!0;else if(13===r)c=!0,10===t.charCodeAt(i)&&++i;else if(r!==o)continue;return t.slice(e,n)}return u=!0,t.slice(e,a)}return 10===t.charCodeAt(a-1)&&--a,13===t.charCodeAt(a-1)&&--a,Zr((function(){if((s=l())!==Qr){const t=[];for(;s!==Yr&&s!==Qr;)t.push(s),s=l();return t}}),n,r&&(t=>(t&&t[0]||"").startsWith(r)))}(t,e);return Kr(n,!1!==e.header?n():e.names,e)}function to(t,e={}){const n=function(t,{skip:e,comment:n}){let r=t.length,o=0;return 10===t.charCodeAt(r-1)&&--r,13===t.charCodeAt(r-1)&&--r,Zr((function(){if(o>=r)return;const e=o;let n,s,a=!1;for(;o<r;)if(10===(s=t.charCodeAt(n=o++))?a=!0:13===s&&(a=!0,10===t.charCodeAt(o)&&++o),a)return t.slice(e,n);return t.slice(e,r)}),e,n&&(t=>(t||"").startsWith(n)))}(t,e),r=function({positions:t,widths:e}){t||e||L('Fixed width files require a "positions" or "widths" option');let n=0;return t||e.map((t=>[n,n+=t]))}(e);return Kr((()=>{const t=n();if(t)return r.map((([e,n])=>t.slice(e,n).trim()))}),e.names,e)}function eo(t){const e=t.length;for(let n=0;n<e;++n){const e=t.charCodeAt(n);if(e<48||e>57)return!1}return!0}function no(t,e={}){const n=Xe(e.autoType);Q(t)&&(t=JSON.parse(t));let r,o=t.data;if(K(o)&&!it(o)?t.schema&&t.schema.fields&&(r=t.schema.fields.map((t=>t.name))):o=t,n||e.parse){const t=e.parse||{};for(const e in o){const r=o[e],s=r.length;if(t[e])for(let n=0;n<s;++n)r[n]=t[e](r[n]);else if(n)for(let t=0;t<s;++t){const e=r[t];Q(e)&&yt(e)&&!eo(e)&&(r[t]=new Date(e))}}}return new mn(o,r)}function ro(t,e){const n=nt();return e.forEach(((e,r)=>{const o=Q(e)?e:r;if(o){const e=t.column(r)||L(`Unrecognized column: ${r}`);n.add(o,e)}})),t.create(n)}function oo(t,e,{before:n,after:r}={}){const o=null!=n,s=null!=r;o||s||L("relocate requires a before or after option."),o&&s&&L("relocate accepts only one of the before or after options."),e=rn(t,e);const a=[...rn(t,o?n:r).keys()],i=o?a[0]:a.pop(),u=new Map;return t.columnNames().forEach((t=>{const n=!e.has(t);if(t===i){s&&n&&u.set(t,t);for(const[t,n]of e)u.set(t,n);if(s)return}n&&u.set(t,t)})),ro(t,u)}function so(t,e=(t=>t),n=""){const r=t.length;if(!r)return"";let o=e(t[0],0);for(let s=1;s<r;++s)o+=n+e(t[s],s);return o}function ao(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function io(t){return Ct(t)?t:+t}class uo{constructor(t){this._values=t||[],this._sorted=null,this._start=0}values(t){return this._start&&(this._values=this._values.slice(this._start),this._start=0),t?this._values.slice():this._values}add(t){this._values.push(t),this._sorted=null}rem(){this._start+=1,this._sorted=null}min(){return this._sorted&&this._sorted.length?this._sorted[0]:function(t,e=0,n=t.length){let r=n?t[e++]:ot;for(let o=e;o<n;++o)r>t[o]&&(r=t[o]);return r}(this._values,this._start)}max(){return this._sorted&&this._sorted.length?this._sorted[this._sorted.length-1]:function(t,e=0,n=t.length){let r=n?t[e++]:ot;for(let o=e;o<n;++o)r<t[o]&&(r=t[o]);return r}(this._values,this._start)}quantile(t){return this._sorted||(this._sorted=this.values(!0),this._sorted.sort(ao)),function(t,e){const n=t.length;if(!n)return ot;if((e=+e)<=0||n<2)return io(t[0]);if(e>=1)return io(t[n-1]);const r=(n-1)*e,o=Math.floor(r),s=io(t[o]);return Ct(s)?s:s+(io(t[o+1])-s)*(r-o)}(this._sorted,t)}}const co=(t,e,n)=>Ur(e,"{"+so(t,((t,r)=>`_${r}.${n}(${e});`))+"}",t);function lo(t,e){const{ops:n,output:r}=function(t,e){const n={},r=[];function o(t,s=[]){const a=t+":"+s;if(n[a])return n[a];const i=de(t),u=i.create(...s);return e<0&&i.stream&&i.stream.forEach((t=>o(t,[]))),i.req&&i.req.forEach((t=>o(t,[]))),n[a]=u,r.push(u),u}const s=t.map((t=>{const e=o(t.name,t.params);return e.output=t.id,e}));return{ops:r,output:s}}(t,e),o=t[0].fields,s=o.length;return new(0===s?fo:1===s?po:2===s?mo:L("Unsupported field count: "+s))(o,n,r,e)}class fo extends hn{constructor(t,e,n,r){super(n),this._op=e,this._fields=t,this._stream=!!r}init(){const t={count:0,valid:0,stream:this._stream};return this._op.forEach((e=>e.init(t))),t.values&&(t.list=new uo),t}write(t,e,n){const r=this._outputs,o=r.length;for(let s=0;s<o;++s)e[r[s].output][n]=r[s].value(t);return 1}_add(){}_rem(){}add(t){++t.count}rem(t){--t.count}}class po extends fo{constructor(t,e,n,r){super(t,e,n,r);const o=["state","v1","v2"];this._add=co(e,o,"add"),this._rem=co(e,o,"rem")}add(t,e,n){const r=this._fields[0](e,n);++t.count,ut(r)&&(++t.valid,t.list&&t.list.add(r),this._add(t,r))}rem(t,e,n){const r=this._fields[0](e,n);--t.count,ut(r)&&(--t.valid,t.list&&t.list.rem(),this._rem(t,r))}}class mo extends fo{constructor(t,e,n,r){super(t,e,n,r);const o=["state","v1","v2"];this._add=co(e,o,"add"),this._rem=co(e,o,"rem")}add(t,e,n){const r=this._fields[0](e,n),o=this._fields[1](e,n);++t.count,ut(r)&&ut(o)&&(++t.valid,t.list&&t.list.add([r,o]),this._add(t,r,o))}rem(t,e,n){const r=this._fields[0](e,n),o=this._fields[1](e,n);--t.count,ut(r)&&ut(o)&&(--t.valid,t.list&&t.list.rem(),this._rem(t,r,o))}}function ho(t,e,n){if(e.length){const r=t.data(),{keys:o}=t.groups()||{},s=go(t,e),a=o?(t,e)=>s[t][o[e]]:t=>s[t][0];n=n.map((t=>e=>t(e,r,a)))}return n}function go(t,e,n){if(!e.length)return n;const r=yo(e),o=t.groups(),s=o?o.size:1;return n=n||V(e.length,(()=>Array(s))),s>1?r.forEach((e=>{const r=vo(t,e,o);for(let t=0;t<s;++t)e.write(r[t],n,t)})):r.forEach((e=>{const r=_o(t,e);e.write(r,n,0)})),n}function yo(t,e){const n=[],r={};for(const e of t){const t=e.fields.map((t=>t+"")).join(",");(r[t]||(r[t]=[])).push(e)}for(const t in r)n.push(lo(r[t],e));return n}function _o(t,e){const n=e.init(),r=t.totalRows(),o=t.data(),s=t.mask();if(t.isOrdered()){const s=t.indices();for(let t=0;t<r;++t)e.add(n,s[t],o)}else if(s)for(let t=s.next(0);t>=0;t=s.next(t+1))e.add(n,t,o);else for(let t=0;t<r;++t)e.add(n,t,o);return n}function vo(t,e,n){const{keys:r,size:o}=n,s=V(o,(()=>e.init())),a=t.data();if(t.isOrdered()){const n=t.indices(),o=n.length;for(let t=0;t<o;++t){const o=n[t];e.add(s[r[o]],o,a)}}else if(t.isFiltered()){const n=t.mask();for(let t=n.next(0);t>=0;t=n.next(t+1))e.add(s[r[t]],t,a)}else{const n=t.totalRows();for(let t=0;t<n;++t)e.add(s[r[t]],t,a)}return s}function bo(t,e){const{get:n,names:r,rows:o,size:s}=e,a=r.length;for(let e=0;e<a;++e){const a=t.add(r[e],Array(s)),i=n[e];for(let t=0;t<s;++t)a[t]=i(o[t])}}function wo(t){return{left(e,n,r,o){for(null==r&&(r=0),null==o&&(o=e.length);r<o;){const s=r+o>>>1;t(e[s],n)<0?r=s+1:o=s}return r},right(e,n,r,o){for(null==r&&(r=0),null==o&&(o=e.length);r<o;){const s=r+o>>>1;t(e[s],n)>0?o=s:r=s+1}return r}}}const xo=wo(ao);function Mo(t,e,n,r={},o){const s=t.data(),a=function(t,e){const n={};return t.forEach((t=>{const e=(t=>(t.frame||[null,null]).map((t=>Number.isFinite(t)?Math.abs(t):null)))(t),r=(t=>!!t.peers)(t),o=`${e},${r}`,{aggOps:s,winOps:a}=n[o]||(n[o]={frame:e,peers:r,aggOps:[],winOps:[]});fe(t.name)?s.push(t):a.push(function(t){const{id:e,name:n,fields:r=[],params:o=[]}=t,s=he(n).create(...o);return r.length&&(s.get=r[0]),s.id=e,s}(t))})),Object.values(n).map((t=>function(t,e,n,r,o){let s,a,i,u,c;const l=t=>a[t-1]===a[t],f=r.length,p=o.length,m=r.length?Ur(["w","r","k"],"{"+so(r,((t,e)=>`r[_${e}.id][k]=_${e}.value(w,_${e}.get);`))+"}",r):()=>{},d={i0:0,i1:0,index:0,size:0,peer:l,init(t,e,n,l){d.index=d.i0=d.i1=0,d.size=e.length,s=t,a=e,u=n,c=l,i=o?o.map((t=>t.init())):null;for(let t=0;t<f;++t)r[t].init();return d},value:(e,n)=>n(s[e],t),step(r){const[f,h]=e,g=d.size,y=d.i0,_=d.i1;d.i0=null!=f?Math.max(0,r-Math.abs(f)):0,d.i1=null!=h?Math.min(g,r+Math.abs(h)+1):g,d.index=r,n&&(d.i0>0&&l(d.i0)&&(d.i0=xo.left(a,a[d.i0])),d.i1<g&&l(d.i1)&&(d.i1=xo.right(a,a[d.i1-1])));for(let e=0;e<p;++e){const n=o[e],r=i[e];for(let e=y;e<d.i0;++e)n.rem(r,s[e],t);for(let e=_;e<d.i1;++e)n.add(r,s[e],t);n.write(r,u,c)}return m(d,u,c),u}};return d}(e,t.frame,t.peers,t.winOps,yo(t.aggOps,null!=t.frame[0]?-1:1))))}(o,s),i=a.length,u=Ur(["r","d","op"],"{"+so(e,((t,e)=>`_${e}[r] = $${e}(r, d, op);`))+"}",e,n);t.partitions().forEach(((e,n)=>{const o=e.length,c=function(t,e){if(t.isOrdered()){const n=t.comparator(),r=t.data(),o=e.length,s=new Uint32Array(o);for(let t=1,a=0;t<o;++t)s[t]=n(e[t-1],e[t],r)?++a:a;return s}return e}(t,e);for(let t=0;t<i;++t)a[t].init(e,c,r,n);const l=t=>r[t][n];for(let t=0;t<o;++t){for(let e=0;e<i;++e)a[e].step(t);u(e[t],s,l)}}))}function jo(t){return pe(t.name)||t.frame&&(Number.isFinite(t.frame[0])||Number.isFinite(t.frame[1]))}function Eo(t,{names:e,exprs:n,ops:r},o={}){const s=t.totalRows(),a=nt(o.drop?null:t),i=e.map((t=>a.add(t,Array(s)))),[u,c]=function(t){const e=[],n=[],r=t.length;for(let o=0;o<r;++o){const r=t[o];r.id=o,(jo(r)?n:e).push(r)}return[e,n]}(r),l=t.isGrouped()?t.groups().size:1,f=go(t,u,V(r.length,(()=>Array(l))));return c.length?Mo(t,i,n,f,c):function(t,e,n,r){const o=t.mask(),s=t.data(),{keys:a}=t.groups()||{},i=a?(t,e)=>r[t][a[e]]:t=>r[t][0],u=e.length;for(let r=0;r<u;++r){const a=n[r],u=e[r];if(o)for(let t=o.next(0);t>=0;t=o.next(t+1))u[t]=a(t,s,i);else{const e=t.totalRows();for(let t=0;t<e;++t)u[t]=a(t,s,i)}}}(t,i,n,f),t.create(a)}const $o=2147483648;class Oo{constructor(t){this._size=t,this._bits=new Uint32Array(Math.ceil(t/32))}get length(){return this._size}count(){const t=this._bits.length;let e=0;for(let n=0;n<t;++n)for(let t=this._bits[n];t;++e)t&=t-1;return e}get(t){return this._bits[t>>5]&$o>>>t}set(t){this._bits[t>>5]|=$o>>>t}clear(t){this._bits[t>>5]&=~($o>>>t)}scan(t){for(let e=this.next(0);e>=0;e=this.next(e+1))t(e)}next(t){const e=this._bits,n=e.length;let r=t>>5,o=e[r]&4294967295>>>t;for(;r<n;o=e[++r])if(0!==o)return(r<<5)+Math.clz32(o);return-1}nth(t){let e=this.next(0);for(;t--&&e>=0;)e=this.next(e+1);return e}not(){const t=this._bits,e=t.length;for(let n=0;n<e;++n)t[n]=~t[n];const n=this._size%32;return n&&(t[e-1]&=$o>>n-1),this}and(t){if(t){const e=this._bits,n=t._bits,r=e.length;for(let t=0;t<r;++t)e[t]&=n[t]}return this}or(t){if(t){const e=this._bits,n=t._bits,r=e.length;for(let t=0;t<r;++t)e[t]|=n[t]}return this}}function ko(t,{names:e=[],exprs:n=[],ops:r=[]},o={}){if(!e.length)return t;const s=o.limit>0?+o.limit:1/0,a=o.index?!0===o.index?"index":o.index+"":null,i=new Set(o.drop),u=ho(t,r,n),c=nt(),l=new Set(e),f=[],p=[],m=[];t.columnNames().forEach((e=>{if(!i.has(e)){const n=c.add(e,[]);l.has(e)||(f.push(t.column(e)),p.push(n))}})),e.forEach((t=>{i.has(t)||(c.has(t)||c.add(t,[]),m.push(c.data[t]))}));const d=a?c.add(a,[]):null;let h=0;const g=f.length,y=m.length,_=(t,e)=>{for(let n=0;n<g;++n)p[n].length=h+e,p[n].fill(f[n].get(t),h,h+e)},v=d?(t,e)=>{for(let n=0;n<e;++n)d[t+n]=n}:()=>{};if(1===y){const e=u[0],n=m[0];t.scan(((t,r)=>{const o=D(e(t,r)),a=Math.min(o.length,s);_(t,a);for(let t=0;t<a;++t)n[h+t]=o[t];v(h,a),h+=a}))}else t.scan(((t,e)=>{let n=0;const r=u.map((r=>{const o=D(r(t,e));return n=Math.min(Math.max(n,o.length),s),o}));_(t,n);for(let t=0;t<y;++t){const e=m[t],o=r[t];for(let t=0;t<n;++t)e[h+t]=o[t]}v(h,n),h+=n}));return t.create(c.new())}function So(t,e,n,r={window:!1}){const o=new Map,s=n=>{Q(n=P(n)?e.columnName(n):n)?o.set(n,ir(n)):J(n)?rn(e,n).forEach(s):K(n)?en(o,n):L(`Invalid ${t} value: ${n+""}`)};return D(n).forEach(s),r.preparse&&r.preparse(o),tr(o,{table:e,...r})}function No(t,e,n,r){const o=n&&n.length;return function(t,{names:e,exprs:n,ops:r},o){const s=ho(t,r,n),a=o?null:nt(t),i=t.totalRows();return e.forEach(((e,n)=>{const r=t.column(e),u=o?r.data:a.add(e,Array(i)),c=s[n];t.scan((t=>{const e=r.get(t);u[t]=ut(e)?e:c(t)}))})),o?t:t.create(a)}(o?function(t,e,n){const r=t.groups(),o=t.data(),s=(r?r.names:[]).concat(e),a=(r?r.get:[]).concat(e.map((e=>t.getter(e)))),i=new Set,u=re(a);t.scan(((t,e)=>i.add(u(t,e))));const c=t.columnNames(),l=nt(),f=c.map((t=>l.add(t,[])));c.forEach(((e,n)=>{const r=o[e],s=f[n];t.scan((t=>s.push(r.get(t))))}));const p=re(a.map(((t,e)=>t=>t[e]))),m=Ur("v","{"+f.map(((t,e)=>`_${e}.push(v[$${e}]);`)).join("")+"}",f,c.map((t=>s.indexOf(t))));if(r){let t=r.keys.length;const e=n.reduce(((t,e)=>t*e.length),r.size),o=new Uint32Array(e+(t-i.size));o.set(r.keys),Ao(r,n,((e,n)=>{i.has(p(e))||(m(e),o[t++]=n[0])})),l.groupby({...r,keys:o})}else Ao(r,n,(t=>{i.has(p(t))||m(t)}));return t.create(l.new())}(t,n,r):t,e,o)}function Ao(t,e,n){const r=t?t.get.length:0,o=t?1:0,s=o+e.length,a=new Int32Array(s),i=new Int32Array(s),u=[];if(t){const{get:e,rows:n,size:o}=t;a[0]=o,u.push(((t,o)=>{const s=n[o];for(let n=0;n<r;++n)t[n]=e[n](s)}))}e.forEach(((t,e)=>{const n=e+r;a[e+o]=t.length,u.push(((e,r)=>e[n]=t[r]))}));const c=Array(r+e.length);for(let t=0;t<s;++t)u[t](c,0);n(c,i);for(let t=s-1;t>=0;){const e=++i[t];e<a[t]?(u[t](c,e),n(c,i),t=s-1):(i[t]=0,u[t](c,0),--t)}}function To(t,{names:e,exprs:n,ops:r}){const o=nt(),s=t.groups();return s&&bo(o,s),function(t,e,n,r=[],o){if(!e.length)return;const s=n?n.size:1,a=(t,e)=>r[t][e],i=t.length;for(let n=0;n<i;++n){const i=e[n];if(null!=i.field)o.add(t[n],r[i.field]);else if(s>1){const e=o.add(t[n],Array(s));for(let t=0;t<s;++t)e[t]=i(t,null,a)}else o.add(t[n],[i(0,null,a)])}}(e,n,s,go(t,r),o),t.create(o.new())}function Io(t){t.forEach(((e,n)=>e.field?t.set(n,Lt(e+"")):0))}function Co(t,e){const n=new Map;return t.scan(((t,r)=>{const o=e(t,r);null!=o&&o==o&&n.set(o,t)})),n}function Uo(t,e,n,{names:r,exprs:o},s={}){const a=t.data(),i=t.indices(!1),u=i.length,c=new Int32Array(u),l=e.data(),f=e.indices(!1),p=f.length,m=new Int32Array(p),d=r.length,h=nt(),g=Array(d),y=Array(d);for(let t=0;t<r.length;++t)g[t]=h.add(r[t],[]),y[t]=o[t];const _=function(t,e){const n=["i","a","j","b"];return Ur(n,"{"+so(t,((t,e)=>`_${e}.push($${e}(${n}));`))+"}",t,e)}(g,y);if((R(n)?Ro:Fo)(_,n,a,l,i,f,c,m,u,p),s.left)for(let t=0;t<u;++t)c[t]||_(i[t],a,-1,l);if(s.right)for(let t=0;t<p;++t)m[t]||_(-1,a,f[t],l);return t.create(h.new())}function Fo(t,e,n,r,o,s,a,i,u,c){for(let l=0;l<u;++l){const u=o[l];for(let o=0;o<c;++o){const c=s[o];e(u,n,c,r)&&(t(u,n,c,r),a[l]=1,i[o]=1)}}}function Ro(t,[e,n],r,o,s,a,i,u,c,l){let f,p,m,d,h,g,y,_,v=t;c>=l?(f=r,p=e,m=i,d=s,h=o,g=n,y=u,_=a):(f=o,p=n,m=u,d=a,h=r,g=e,y=i,_=s,v=(e,n,r,o)=>t(r,o,e,n));const b=function(t,e,n){const r=new Map,o=t.length;for(let s=0;s<o;++s){const o=n(t[s],e);null!=o&&o==o&&(r.has(o)?r.get(o).push(s):r.set(o,[s]))}return r}(_,h,g),w=d.length;for(let t=0;t<w;++t){const e=d[t],n=b.get(p(e,f));if(n){const r=n.length;for(let t=0;t<r;++t){const r=n[t];v(e,f,_[r],h),y[r]=1}m[t]=1}}}function Do(t,e,n){const r=new Map;D(n).forEach(((n,o)=>{Q(n=P(n)?e.columnName(n):n)?r.set(o,ir(n)):J(n)||K(n)&&n.expr?r.set(o,n):L(`Invalid ${t} key value: ${n+""}`)}));return re(tr(r,{table:e,aggregate:!1,window:!1}).exprs,!0)}function zo(t,e,n){if(n)Q(n)?n=[n,n]:R(n)&&1===n.length&&(n=[n[0],n[0]]);else{const r=function(t,e){const n=new Set(e);return t.filter((t=>n.has(t)))}(t.columnNames(),e.columnNames());r.length||L("Natural join requires shared column names."),n=[r,r]}return n}function qo(t,e,n,r){return n.length!==r.length&&L("Mismatched number of join keys"),[Do("join",t,n),Do("join",e,r)]}const Lo={aggregate:!1,window:!1,index:1};function Po(t,e,n,r,o={}){n=zo(t,e,n);const s={join:[t,e]};let a;if(R(n)){const[s,i]=n.map(D);a=qo(t,e,s,i),r||(r=function(t,e,n,r){const o=[];e.forEach(((t,e)=>Q(t)&&t===n[e]?o.push(t):0));const s=un(o);if(r.left&&r.right){const e=new Set(o);return[t.columnNames().map((t=>{const n=`[${Ut(t)}]`;return e.has(t)?{[t]:`(a, b) => a${n} == null ? b${n} : a${n}`}:t})),s]}return r.right?[s,an()]:[an(),s]}(t,s,i,o))}else a=tr({on:n},s).exprs[0],r||(r=[an(),an()]);return Uo(t,e,a,function(t,e,n,r,o=[]){if(R(n)){let s,a,i,u=n.length;s=a=i={names:[],exprs:[]},u--&&(s=So("join",t,n[0],r)),u--&&(a=So("join",e,n[1],Lo)),u--&&(i=tr(n[2],r));const c=new Set,l=new Set(s.names);return a.names.forEach((t=>{l.has(t)&&c.add(t)})),c.size&&(Jo(s.names,c,o[0]||"_1"),Jo(a.names,c,o[1]||"_2")),{names:s.names.concat(a.names,i.names),exprs:s.exprs.concat(a.exprs,i.exprs)}}return tr(n,r)}(t,e,r,s,o&&o.suffix),o)}function Jo(t,e,n){t.forEach(((r,o)=>e.has(r)?t[o]=r+n:0))}function Vo(t,e,n,[r,o]){const s=Co(n,o);e.scan(((e,n)=>{s.get(r(e,n))>=0&&t.set(e)}))}function Bo(t,e,n,r){const o=e.numRows(),s=n.numRows(),a=e.data(),i=n.data();if(e.isFiltered()||n.isFiltered()){const u=e.indices(!1),c=n.indices(!1);for(let e=0;e<o;++e){const n=u[e];for(let e=0;e<s;++e)if(r(n,a,c[e],i)){t.set(n);break}}}else for(let e=0;e<o;++e)for(let n=0;n<s;++n)if(r(e,a,n,i)){t.set(e);break}}function Go(t,e,n,r){n=zo(t,e,n);return function(t,e,n,r={}){const o=new Oo(t.totalRows());return(R(n)?Vo:Bo)(o,t,e,n),r.anti&&o.not().and(t.mask()),t.create({filter:o})}(t,e,R(n)?qo(t,e,...n.map(D)):tr({on:n},{join:[t,e]}).exprs[0],r)}const Ho=(t,e)=>null!=t?t:e;function Wo(t,e,n,r={}){const{keys:o,keyColumn:s}=function(t,e,n){const r=n.limit>0?+n.limit:1/0,o=Ho(n.sort,!0),s=Ho(n.keySeparator,"_"),a=ho(t,e.ops,e.exprs),i=1===a.length?a[0]:(t,e)=>a.map((n=>n(t,e))).join(s),u=Array(t.totalRows());t.scan(((t,e)=>u[t]=i(t,e)));const c=go(t.ungroup(),[{id:0,name:"array_agg_distinct",fields:[t=>u[t]],params:[]}])[0][0],l=o?c.sort():c;return{keys:Number.isFinite(r)?l.slice(0,r):l,keyColumn:u}}(t,e,r),a=Ho(r.valueSeparator,"_"),i=n.names.length>1?(t,e)=>e+a+o[t]:t=>o[t],u=o.map((e=>go(t,n.ops.map((t=>{if("count"===t.name){const n=t=>e===s[t]?1:NaN;return n.toString=()=>e+":1",{...t,name:"sum",fields:[n]}}const n=t.fields.map((t=>{const n=(n,r)=>e===s[n]?t(n,r):NaN;return n.toString=()=>e+":"+t,n}));return{...t,fields:n}})))));return t.create(function({names:t,exprs:e},n,r,o){const s=r?r.size:1,a=nt(),i=o.length,u=t.length;let c;const l=(t,e)=>c[t][e];r&&bo(a,r);for(let r=0;r<u;++r){const u=e[r];if(null!=u.field)for(let e=0;e<i;++e)a.add(n(e,t[r]),o[e][u.field]);else if(s>1)for(let e=0;e<i;++e){c=o[e];const i=a.add(n(e,t[r]),Array(s));for(let t=0;t<s;++t)i[t]=u(t,null,l)}else for(let e=0;e<i;++e)c=o[e],a.add(n(e,t[r]),[u(0,null,l)])}return a.new()}(n,i,t.groups(),u))}function Ko(t){t.forEach(((e,n)=>e.field?t.set(n,Dt(e+"")):0))}function Yo(t,e){return To(t,tr(e,{table:t,aggronly:!0,window:!1}))}function Qo(t,e,n,r){return(e?r?Xo:Zo:r?es:ts)(t.length,t,n,r)}function Zo(t,e,n){const r=n.length;for(let o=0;o<t;++o)e[o]=n[r*$t()|0];return e}function Xo(t,e,n,r){const o=n.length,s=new Float64Array(o);let a=0;for(let t=0;t<o;++t)s[t]=a+=r(n[t]);const i=wo(ao).right;for(let r=0;r<t;++r)e[r]=n[i(s,a*$t())];return e}function ts(t,e,n){const r=n.length;if(t>=r)return n;for(let r=0;r<t;++r)e[r]=n[r];for(let o=t;o<r;++o){const r=o*$t();r<t&&(e[0|r]=n[o])}return e}function es(t,e,n,r){const o=n.length;if(t>=o)return n;const s=new Float32Array(o),a=new Uint32Array(o);for(let t=0;t<o;++t)a[t]=t,s[t]=-Math.log($t())/r(n[t]);a.sort(((t,e)=>s[t]-s[e]));for(let r=0;r<t;++r)e[r]=n[a[r]];return e}function ns(t,e,n,r={}){const{replace:o,shuffle:s}=r,a=t.partitions(!1);let i=0;e=a.map(((t,n)=>{let r=e(n);return i+=r=o?r:Math.min(t.length,r),r}));const u=new Uint32Array(i);let c=0;return a.forEach(((t,r)=>{const s=e[r],a=u.subarray(c,c+=s);o||s!==t.length?Qo(a,o,t,n):a.set(t)})),!1!==s&&(a.length>1||!o)&&function(t,e=0,n=t.length){let r=n-(e=+e);for(;r;){const n=$t()*r--|0,o=t[r+e];t[r+e]=t[n+e],t[n+e]=o}}(u),t.reify(u)}const rs=t=>e=>t.get(e)||0;function os(t,{names:e,exprs:n,ops:r=[]},o={}){if(0===e.length)return t;const s=1===e.length&&o.as||[],a=null==o.drop||!!o.drop,i=null==o.limit?s.length||1/0:Math.max(1,+o.limit||1),u=ho(t,r,n),c=nt(),l=e.reduce(((t,e,n)=>t.set(e,n)),new Map),f=(e,n)=>{const r=function(t,e,n){const r=t.totalRows(),o=[];return t.scan(((t,s)=>{const a=D(e(t,s)),i=Math.min(a.length,n);for(;o.length<i;)o.push(Array(r).fill(ot));for(let e=0;e<i;++e)o[e][t]=a[e]})),o}(t,u[e],i),o=r.length;for(let t=0;t<o;++t)c.add(s[t]||`${n}_${t+1}`,r[t])};return t.columnNames().forEach((e=>{l.has(e)?(a||c.add(e,t.column(e)),f(l.get(e),e),l.delete(e)):c.add(e,t.column(e))})),l.forEach(f),t.create(c)}function ss(t,{names:e=[],exprs:n=[],ops:r=[]}){const o=e.length;if(0===o)return null;if(1===o&&!t.isFiltered()&&n[0].field){const r=t.column(n[0].field);if(r.groups)return r.groups(e)}let s=ho(t,r,n);const a=re(s),i=t.totalRows(),u=new Uint32Array(i),c={},l=[],f=t.data(),p=t.mask();if(p)for(let t=p.next(0);t>=0;t=p.next(t+1)){const e=a(t,f)+"",n=c[e];u[t]=null!=n?n:c[e]=l.push(t)-1}else for(let t=0;t<i;++t){const e=a(t,f)+"",n=c[e];u[t]=null!=n?n:c[e]=l.push(t)-1}return r.length||(s=s.map((t=>e=>t(e,f)))),{keys:u,get:s,names:e,rows:l,size:l.length}}const as=(t,e,n,r)=>`((u = ${t}) < (v = ${e}) || u == null) && v != null ? ${n}\n    : (u > v || v == null) && u != null ? ${r}\n    : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}\n    : v !== v && u === u ? ${r} : `;var is={__antijoin:(t,e,n)=>Go(t,e,n,{anti:!0}),__count:(t,e={})=>Yo(t,{[e.as||"count"]:zt()}),__cross:(t,e,n,r)=>Po(t,e,(()=>!0),n,{...r,left:!0,right:!0}),__concat:function(t,e){const n=t.numRows(),r=n+e.reduce(((t,e)=>t+e.numRows()),0);if(n===r)return t;const o=[t,...e],s=nt();return t.columnNames().forEach((t=>{const e=Array(r);let n=0;o.forEach((r=>{const o=r.column(t)||{get:()=>ot};r.scan((t=>e[n++]=o.get(t)))})),s.add(t,e)})),t.create(s.new())},__dedupe:function(t,e=[]){return t.groupby(e.length?e:t.columnNames()).filter("row_number() === 1").ungroup().reify()},__derive:function(t,e,n={}){const r=Eo(t,tr(e,{table:t}),n);return n.drop||null==n.before&&null==n.after?r:oo(r,Object.keys(e).filter((e=>!t.column(e))),n)},__except:function(t,e){if(0===e.length)return t;const n=t.columnNames();return e.reduce(((t,e)=>t.antijoin(e.select(n))),t).dedupe()},__filter:function(t,e){const n=tr({p:e},{table:t});let r=n.exprs[0];if(n.ops.length){const{data:e}=Eo(t,n,{drop:!0}).column("p");r=t=>e[t]}return function(t,e){const n=t.totalRows(),r=t.mask(),o=t.data(),s=new Oo(n);if(r)for(let t=r.next(0);t>=0;t=r.next(t+1))e(t,o)&&s.set(t);else for(let t=0;t<n;++t)e(t,o)&&s.set(t);return t.create({filter:s})}(t,r)},__fold:function(t,e,n){return function(t,{names:e=[],exprs:n=[],ops:r=[]},o={}){if(0===e.length)return t;const[s="key",a="value"]=o.as||[],i=ho(t,r,n);return ko(t,{names:[s,a],exprs:[()=>e,(t,e)=>i.map((n=>n(t,e)))]},{...o,drop:e})}(t,So("fold",t,e),n)},__impute:function(t,e,n={}){if((e=tr(e,{table:t})).names.forEach((e=>t.column(e)?0:L(`Invalid impute column ${Ut(e)}`))),n.expand){const r={preparse:Io,aggronly:!0},o=So("impute",t,n.expand,r),s=To(t.ungroup(),o);return No(t,e,o.names,o.names.map((t=>s.get(t,0))))}return No(t,e)},__intersect:function(t,e){const n=t.columnNames();return e.length?e.reduce(((t,e)=>t.semijoin(e.select(n))),t).dedupe():t.reify([])},__join:Po,__lookup:function(t,e,n,r){return function(t,e,[n,r],{names:o,exprs:s,ops:a}){const i=nt(t),u=t.totalRows();o.forEach((t=>i.add(t,Array(u).fill(ot))));const c=Co(e,r),l=Ur(["lr","rr","data"],"{"+so(o,((t,e)=>`_[${e}][lr] = $[${e}](rr, data);`))+"}",o.map((t=>i.data[t])),ho(e,a,s)),f=e.data();return t.scan(((t,e)=>{const r=c.get(n(t,e));r>=0&&l(t,r,f)})),t.create(i)}(t,e,[Do("lookup",t,(n=zo(t,e,n))[0]),Do("lookup",e,n[1])],So("lookup",e,r))},__pivot:function(t,e,n,r){return Wo(t,So("fold",t,e),So("fold",t,n,{preparse:Ko,aggronly:!0}),r)},__relocate:oo,__rename:function(t,e){const n=new Map;return t.columnNames((t=>(n.set(t,t),0))),ro(t,rn(t,e,n))},__rollup:Yo,__sample:function(t,e,n={}){return ns(t,function(t,e){return P(e)?()=>e:rs(To(t,tr({size:e},{table:t,window:!1})).column("size"))}(t,e),function(t,e){return null==e?null:(e=P(e)?t.columnName(e):e,rs(Q(e)?t.column(e):Eo(t,tr({w:e},{table:t}),{drop:!0}).column("w")))}(t,n.weight),n)},__select:function(t,e){return ro(t,rn(t,e))},__semijoin:Go,__spread:function(t,e,n){return os(t,So("spread",t,e),n)},__union:function(t,e){return t.concat(e).dedupe()},__unroll:function(t,e,n){return ko(t,So("unroll",t,e),n&&n.drop?{...n,drop:So("unroll",t,n.drop).names}:n)},__groupby:function(t,e){return function(t,e){return t.create({groups:ss(t,e)})}(t,So("groupby",t,e))},__orderby:function(t,e){return function(t,e){return t.create({order:e})}(t,function(t,e){let n=-1;const r=new Map,o=t=>r.set(++n+"",t);return e.forEach((e=>{const n=null!=e.expr?e.expr:e;if(K(n)&&!J(n))for(const t in n)o(n[t]);else o(P(n)?ir(e,t.columnName(n)):Q(n)?ir(e):J(n)?e:L("Invalid orderby field: "+(e+"")))})),function(t,e){const n=[],r=[],o=[];let s=null,a="0",i="0";t.isGrouped()&&(s=t.groups().keys,a="ka",i="kb");const{ops:u}=tr(e,{table:t,value:(t,e)=>{if(n.push(t),e.escape){const t=t=>`fn[${o.length}](${t}, data)`;r.push([t("a"),t("b")]),o.push(e.escape)}else r.push([ee(e,{index:"a",op:a}),ee(e,{index:"b",op:i})])},window:!1}),c=go(t,u),l=(t,e)=>c[t][e],f=n.length;let p="return (a, b) => {"+(l&&t.isGrouped()?"const ka = keys[a], kb = keys[b];":"")+"let u, v; return ";for(let t=0;t<f;++t){const o=e.get(n[t]).desc?-1:1,[s,a]=r[t];p+=as(s,a,-o,o)}return p+="0;};",Function("op","keys","fn","data",p)(l,s,o,t.data())}(t,r)}(t,e))},__ungroup:function(t){return t.isGrouped()?t.create({groups:null}):t},__unorder:function(t){return t.isOrdered()?t.create({order:null}):t},__reduce:function(t,e){const n=nt(),r=t.groups(),{get:o,names:s=[],rows:a,size:i=1}=r||{},u=new Uint32Array(i+1);s.forEach((t=>n.add(t,null)));const c=r?vo(t,e,r):[_o(t,e)];e.outputs().map((t=>n.add(t,[])));const l=u.length-1;let f=0;for(let t=0;t<l;++t)f+=u[t+1]=e.write(c[t],n.data,u[t]);if(r){const e=t.data();s.forEach(((t,r)=>{const s=n.data[t]=Array(f),c=o[r];for(let t=0,n=0;t<i;++t)s.fill(c(a[t],e),n,n+=u[t+1])}))}return t.create(n.new())}};function us(t,e){return mn.new(t,e)}function cs(t,e){return mn.from(t,e)}function ls(t,e={}){const n=e.using||Xr;return fetch(t,e.fetch).then((t=>t[e.as||"text"]())).then((t=>n(t,e)))}function fs(t,e){return ls(t,{...e,as:"arrayBuffer",using:Lr})}function ps(t,e){return ls(t,{...e,as:"text",using:Xr})}function ms(t,e){return ls(t,{...e,as:"text",using:to})}function ds(t,e){return ls(t,{...e,as:"json",using:hs})}function hs(t,e){return R(t)?cs(t):no(t,e)}function gs(t,e={}){const n=`d[${JSON.stringify(t)}]`,{maxbins:r,nice:o,minstep:s,step:a,offset:i}=e,u=[r,o,s,a];let c=u.length;for(;c&&null==u[--c];)u.pop();return`d => op.bin(${n}, ...op.bins(${n}${u.length?", "+u.map((t=>t+"")).join(", "):""}), ${i||0})`}function ys(t){return or(t,{escape:!0,toString(){L("Escaped values can not be serialized.")}})}function _s(t){return`() => op.round(${+t} * op.count())`}function vs(...t){return t=t.flat(),e=>{const n=new Map,r=Math.min(t.length,e.numCols());for(let o=0;o<r;++o)n.set(e.columnName(o),t[o]);return n}}function bs(t,e){return t.ungroup().rollup({_:e}).get("_")}Object.assign(mn.prototype,is);const ws=(t,e)=>L(`Illegal ${e} name: ${Ut(t)}`),xs=(t,e)=>L(`The ${e} name ${Ut(t)} is reserved and can not be overridden.`);function Ms(t,e,n=Bt,r="function"){t||ws(t,r),!e.override&&et(n,t)&&((t,e)=>{L(`The ${e} ${Ut(t)} is already defined. Use override option?`)})(t,r)}function js(t,e,n,r){return n[t]===e||Ms(t,r)}function Es(t,e,n,r={}){if(js(t,e,n,r))return;const[o=0,s=0]=e.param;n[t]=e,Bt[t]=(...e)=>Ft(t,e.slice(0,o),e.slice(o,o+s))}function $s(t,e,n){Es(t,e,ie,n)}function Os(t,e,n){Es(t,e,le,n)}function ks(t,e,n={}){1===arguments.length&&(""===(t=(e=t).name)||"anonymous"===t?L("Anonymous function provided, please include a name argument."):"row_object"===t&&xs("row_object","function")),js(t,e,It,n)||(It[t]=e,Bt[t]=e)}const Ss=mn.prototype;let Ns;function As(t){for(;t;t=Object.getPrototypeOf(t))Object.getOwnPropertyNames(t).forEach((t=>Ns[t]=1))}function Ts(t,e,n){const r="method";if(Ss[t]&&Ss[t].fn===e)return!0;Ns||(Ns={},As(Ss),As(Nr.prototype)),Ns[t]&&xs(t,r),"_"===(t+"")[0]&&ws(t,r),Ms(t,n,Ss,r)}function Is(t,e,n={}){Ts(t,e,n)||(Ss[t]=function(...t){return e(this,...t)},Ss[t].fn=e)}function Cs(t,e,n,r={}){Is(t,e,r),function(t,e){Nr.prototype[t]=function(...t){return Tr(this,e(...t))}}(t,Or[t]=$r(t,n))}function Us(t,e={}){const n=t&&t.arquero_package||t,r={functions:[(t,e,n)=>js(t,e,It,n),ks],aggregateFunctions:[(t,e,n)=>js(t,e,ie,n),$s],windowFunctions:[(t,e,n)=>js(t,e,le,n),Os],tableMethods:[Ts,Is],verbs:[(t,e,n)=>Ts(t,e.method,n),(t,e,n)=>Cs(t,e.method,e.params,n)]};function o(t){for(const o in r){const s=r[o],a=n[o];for(const n in a)s[t](n,a[n],e)}}o(0),o(1)}const Fs={Table:B,ColumnTable:mn,Transformable:q,Query:Nr,Reducer:hn,Verb:Er,Verbs:Or,columnFactory:function(t){return arguments.length?H=t:H},parse:tr,walk_ast:gn},Rs=Ir;export{$s as addAggregateFunction,ks as addFunction,Us as addPackage,Is as addTableMethod,Cs as addVerb,Os as addWindowFunction,bs as agg,an as all,gs as bin,ar as desc,pn as endswith,ys as escape,ir as field,_s as frac,cs as from,Lr as fromArrow,Xr as fromCSV,to as fromFixed,no as fromJSON,Fs as internal,ls as load,fs as loadArrow,ps as loadCSV,ms as loadFixed,ds as loadJSON,ln as matches,vs as names,un as not,Bt as op,kr as query,Sr as queryFrom,cn as range,ur as rolling,Ot as seed,fn as startswith,us as table,Ge as toArrow,Rs as version};export default null;
//# sourceMappingURL=/sm/22e1c8556292df4c5091580cc56eeba3b5baa7990f634204f364a4e91517a06c.map